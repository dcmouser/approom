<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>controllers/crudaid.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JrResult.JrContext.html">JrContext</a></li><li><a href="JrResult.JrResult.html">JrResult</a></li><li><a href="module-client_arclient-AppRoomClient.html">AppRoomClient</a></li><li><a href="module-controllers_aclaid-AclAid.html">AclAid</a></li><li><a href="module-controllers_adminaid-AdminAid.html">AdminAid</a></li><li><a href="module-controllers_arserver-AppRoomServer.html">AppRoomServer</a><ul class='methods'><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#emergencyAlert">emergencyAlert</a></li><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#makeSecureTokenAccess">makeSecureTokenAccess</a></li><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#makeSecureTokenAccessFromRefreshToken">makeSecureTokenAccessFromRefreshToken</a></li><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#makeSecureTokenRefresh">makeSecureTokenRefresh</a></li></ul></li><li><a href="module-controllers_crudaid-CrudAid.html">CrudAid</a></li><li><a href="module-controllers_registrationaid-RegistrationAid.html">RegistrationAid</a></li><li><a href="module-controllers_sendaid-SendAid.html">SendAid</a><ul class='methods'><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMail">sendMail</a></li><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMessage">sendMessage</a></li></ul></li><li><a href="module-controllers_setupaid-SetupAid.html">SetupAid</a></li><li><a href="module-helpers_jrresult-JrResult.html">JrResult</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#._unusedCodeExpressMiddlewareInjectSessionResult">_unusedCodeExpressMiddlewareInjectSessionResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isJrResult">isJrResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeClone">makeClone</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeError">makeError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeMessage">makeMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeNew">makeNew</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeSuccess">makeSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.passportOrJrResultErrorAsString">passportOrJrResultErrorAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.retrieveThenRemoveFromSession">retrieveThenRemoveFromSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.undefinedIfBlank">undefinedIfBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#addToSession">addToSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clear">clear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clearSection">clearSection</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getErrorsAsString">getErrorsAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getExtraData">getExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getFieldError">getFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getSuccessAsString">getSuccessAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getType">getType</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#isError">isError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#mergeIn">mergeIn</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#mergeInThenRemoveFromSession">mergeInThenRemoveFromSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#push">push</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushBiFieldError">pushBiFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushError">pushError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushErrorOnTop">pushErrorOnTop</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushException">pushException</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushFieldError">pushFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushMessage">pushMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushSuccess">pushSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setError">setError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setExtraData">setExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setFieldError">setFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setType">setType</a></li></ul></li><li><a href="module-models_app-AppModel.html">AppModel</a></li><li><a href="module-models_connection-ConnectionModel.html">ConnectionModel</a></li><li><a href="module-models_file-FileModel.html">FileModel</a></li><li><a href="module-models_login-LoginModel.html">LoginModel</a></li><li><a href="module-models_log-LogModel.html">LogModel</a></li><li><a href="module-models_model_base_mongoose_minimal-ModelBaseMongooseMinimal.html">ModelBaseMongooseMinimal</a></li><li><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html">ModelBaseMongoose</a><ul class='methods'><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#.doChangeModeById">doChangeModeById</a></li><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#doChangeMode">doChangeMode</a></li></ul></li><li><a href="module-models_modqueue-ModQueueModel.html">ModQueueModel</a></li><li><a href="module-models_option-OptionModel.html">OptionModel</a></li><li><a href="module-models_option-RoleModel.html">RoleModel</a></li><li><a href="module-models_roomdata-RoomdataModel.html">RoomdataModel</a></li><li><a href="module-models_room-RoomModel.html">RoomModel</a></li><li><a href="module-models_session-SessionModel.html">SessionModel</a></li><li><a href="module-models_subscription-SubscriptionModel.html">SubscriptionModel</a></li><li><a href="module-models_user-UserModel.html">UserModel</a><ul class='methods'><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermission">aclHasPermission</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionOnAll">aclHasPermissionOnAll</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionSeeVDeletes">aclHasPermissionSeeVDeletes</a></li></ul></li><li><a href="module-models_verification-VerificationModel.html">VerificationModel</a></li></ul><h3>Modules</h3><ul><li><a href="module-arglobals.html">arglobals</a><ul class='methods'><li data-type='method'><a href="module-arglobals.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-client_arclient.html">client/arclient</a><ul class='methods'><li data-type='method'><a href="module-client_arclient.html#~makeNewAppRoomClient">makeNewAppRoomClient</a></li></ul></li><li><a href="module-clientTests.html">clientTests</a></li><li><a href="module-controllers_aclaid.html">controllers/aclaid</a></li><li><a href="module-controllers_adminaid.html">controllers/adminaid</a></li><li><a href="module-controllers_appdef.html">controllers/appdef</a></li><li><a href="module-controllers_arserver.html">controllers/arserver</a></li><li><a href="module-controllers_crudaid.html">controllers/crudaid</a></li><li><a href="module-controllers_jrequireaid.html">controllers/jrequireaid</a><ul class='methods'><li data-type='method'><a href="module-controllers_jrequireaid.html#~setDeferredLoading">setDeferredLoading</a></li><li data-type='method'><a href="module-controllers_jrequireaid.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-controllers_registrationaid.html">controllers/registrationaid</a></li><li><a href="module-controllers_sendaid.html">controllers/sendaid</a></li><li><a href="module-controllers_setupaid.html">controllers/setupaid</a></li><li><a href="module-helpers_jrconfig.html">helpers/jrconfig</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrconfig.html#~addConfigFile">addConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~addConfigFilesCli">addConfigFilesCli</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~configAutoConverTypeVal">configAutoConverTypeVal</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~discoverConfigFiles">discoverConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~doNconfFile">doNconfFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~findQueuedCommand">findQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~fixConfigFilePathName">fixConfigFilePathName</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugFiles">getDebugFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugHierarchy">getDebugHierarchy</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugOptions">getDebugOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getVal">getVal</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getValDefault">getValDefault</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~ipStringToSafeFilenameString">ipStringToSafeFilenameString</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeConfigFile">nconfMergeConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~parse">parse</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~popQueuedCommand">popQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~queueYargsCommand">queueYargsCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~runQueuedCommands">runQueuedCommands</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setConfigDirs">setConfigDirs</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setDefaultOptions">setDefaultOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setEnvList">setEnvList</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setOverrideOptions">setOverrideOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setServerFilenamePrefixFromServerIp">setServerFilenamePrefixFromServerIp</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setYargs">setYargs</a></li></ul></li><li><a href="module-helpers_jrcontext.html">helpers/jrcontext</a></li><li><a href="module-helpers_jrdebug.html">helpers/jrdebug</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebug">cdebug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugf">cdebugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugObj">cdebugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debug">debug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugf">debugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugObj">debugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugObj2">debugObj2</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~getDebugTagEnabled">getDebugTagEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setDebugTagEnabled">setDebugTagEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setupDebugmod">setupDebugmod</a></li></ul></li><li><a href="module-helpers_jrequire.html">helpers/jrequire</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrequire.html#~calcDebugInfo">calcDebugInfo</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~fixRequirePath">fixRequirePath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~jrequire">jrequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerPath">registerPath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerRequire">registerRequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~setDeferredLoading">setDeferredLoading</a></li></ul></li><li><a href="module-helpers_jrh_axios.html">helpers/jrh_axios</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_axios.html#~calcAxiosOptions">calcAxiosOptions</a></li><li data-type='method'><a href="module-helpers_jrh_axios.html#~getCatchError">getCatchError</a></li><li data-type='method'><a href="module-helpers_jrh_axios.html#~postAxiosGetResponseDataCatchError">postAxiosGetResponseDataCatchError</a></li></ul></li><li><a href="module-helpers_jrh_crypto.html">helpers/jrh_crypto</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_crypto.html#~createHashedObjectFromString">createHashedObjectFromString</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~generateRandomSalt">generateRandomSalt</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringFromCharSet">genRandomStringFromCharSet</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHex">genRandomStringHex</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasier">genRandomStringHumanEasier</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasy">genRandomStringHumanEasy</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextPasswordToObj">hashPlaintextPasswordToObj</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextStringInsecureButSearchable">hashPlaintextStringInsecureButSearchable</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~testPlaintextPassword">testPlaintextPassword</a></li></ul></li><li><a href="module-helpers_jrh_express.html">helpers/jrh_express</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPassportAuthenticate">asyncPassportAuthenticate</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPassportReqLogin">asyncPassportReqLogin</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddleWare">calcExpressMiddleWare</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareGetFileLine">calcExpressMiddlewareGetFileLine</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareRouterHint">calcExpressMiddlewareRouterHint</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathData">calcExpressRoutePathData</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataRouteArray">calcExpressRoutePathDataRouteArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataSplit">calcExpressRoutePathDataSplit</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~forgetSessionVar">forgetSessionVar</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~normalizePort">normalizePort</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~parseReqGetJsonField">parseReqGetJsonField</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqOriginalUrl">reqOriginalUrl</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedCheckboxItemIds">reqPrefixedCheckboxItemIds</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedValueArray">reqPrefixedValueArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqUrlWithPath">reqUrlWithPath</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqVal">reqVal</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValAsInt">reqValAsInt</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValFromList">reqValFromList</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendJsonDataSuccess">sendJsonDataSuccess</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendJsonErorrAcl">sendJsonErorrAcl</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendJsonError">sendJsonError</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendJsonErrorAuthToken">sendJsonErrorAuthToken</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendJsonResult">sendJsonResult</a></li></ul></li><li><a href="module-helpers_jrh_grid.html">helpers/jrh_grid</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_grid.html#~calcHeaderKeysNicely">calcHeaderKeysNicely</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridList">jrGridList</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListBulkActions">jrGridListBulkActions</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPager">jrGridListPager</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItem">jrGridListPagerItem</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItemPerPage">jrGridListPagerItemPerPage</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListShowHiddenOptions">jrGridListShowHiddenOptions</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTable">jrGridListTable</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableData">jrGridListTableData</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeader">jrGridListTableHeader</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeaderSortDir">jrGridListTableHeaderSortDir</a></li></ul></li><li><a href="module-helpers_jrh_handlebars.html">helpers/jrh_handlebars</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~loadPartialFiles">loadPartialFiles</a></li><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~setupJrHandlebarHelpers">setupJrHandlebarHelpers</a></li></ul></li><li><a href="module-helpers_jrh_misc.html">helpers/jrh_misc</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncAwaitForEachFunctionCall">asyncAwaitForEachFunctionCall</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncAwaitForEachObjectKeyFunctionCall">asyncAwaitForEachObjectKeyFunctionCall</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncNextTick">asyncNextTick</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~copyMissingValues">copyMissingValues</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~createObjectFromJsonParse">createObjectFromJsonParse</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~DateNowPlusMinutes">DateNowPlusMinutes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~deepIterationCopy">deepIterationCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~ErrorToHashableMapObject">ErrorToHashableMapObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~findLongestPrefixAndRemainder">findLongestPrefixAndRemainder</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~firstCoercedTrueValue">firstCoercedTrueValue</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getCompactNowString">getCompactNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDateValString">getNiceDateValString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDurationTimeMs">getNiceDurationTimeMs</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceNowString">getNiceNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonFalseValueOrDefault">getNonFalseValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueFromObject">getNonNullValueFromObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueOrDefault">getNonNullValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getPreciseNowString">getPreciseNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getServerIpAddress">getServerIpAddress</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isInAnyArray">isInAnyArray</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectEmpty">isObjectEmpty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectHashMappableType">isObjectHashMappableType</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isPromise">isPromise</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isSimpleObject">isSimpleObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~makeSafeForFormInput">makeSafeForFormInput</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysDedupe">mergeArraysDedupe</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysKeepDupes">mergeArraysKeepDupes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objectHasProperty">objectHasProperty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objToString">objToString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objToString2">objToString2</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~regexEscapeStr">regexEscapeStr</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~resolvePossiblyRelativeDirectory">resolvePossiblyRelativeDirectory</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~shallowCopy">shallowCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~stringArrayToNiceString">stringArrayToNiceString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~usleep">usleep</a></li></ul></li><li><a href="module-helpers_jrh_mongo.html">helpers/jrh_mongo</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseInfo">calcDatabaseInfo</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseStructure">calcDatabaseStructure</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~convertArrayOfObjectIdsToIdArray">convertArrayOfObjectIdsToIdArray</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~isValidMongooseObjectId">isValidMongooseObjectId</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~OldUnusedMongoIdEqual">OldUnusedMongoIdEqual</a></li></ul></li><li><a href="module-helpers_jrh_mongo_filter.html">helpers/jrh_mongo_filter</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~buildMongooseQueryFromReq">buildMongooseQueryFromReq</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilter">convertReqQueryStringToAMongooseFindFilter</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterBoolean">convertReqQueryStringToAMongooseFindFilterBoolean</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperator">convertReqQueryStringToAMongooseFindFilterGenericOperator</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal">convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterMongoStrCmp">convertReqQueryStringToAMongooseFindFilterMongoStrCmp</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterNumeric">convertReqQueryStringToAMongooseFindFilterNumeric</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterStringic">convertReqQueryStringToAMongooseFindFilterStringic</a></li></ul></li><li><a href="module-helpers_jrh_ratelimiter.html">helpers/jrh_ratelimiter</a></li><li><a href="module-helpers_jrh_text.html">helpers/jrh_text</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_text.html#~capitalizeFirstLetter">capitalizeFirstLetter</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrBootstrapCollapseBox">jrBootstrapCollapseBox</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormInputPassword">jrHtmlFormInputPassword</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionList">jrHtmlFormOptionList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionListSelect">jrHtmlFormOptionListSelect</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlNiceOptionFromList">jrHtmlNiceOptionFromList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlStrigifyObject">jrHtmlStrigifyObject</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralize">jrPluralize</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralizeCount">jrPluralizeCount</a></li></ul></li><li><a href="module-helpers_jrh_validate.html">helpers/jrh_validate</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateInteger">validateInteger</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateIntegerRange">validateIntegerRange</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateJsonObjOrStringToObj">validateJsonObjOrStringToObj</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateRealName">validateRealName</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateString">validateString</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateTrueFalse">validateTrueFalse</a></li></ul></li><li><a href="module-helpers_jrlog.html">helpers/jrlog</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrlog.html#~aliasWinstonLogger">aliasWinstonLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~calcLogFilePath">calcLogFilePath</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createLogFileObj">createLogFileObj</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createWinstonLoggerObject">createWinstonLoggerObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~getWinstonCategoryLogger">getWinstonCategoryLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~log">log</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logDefaultError">logDefaultError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionError">logExceptionError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionErrorWithMessage">logExceptionErrorWithMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logMessage">logMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logObject">logObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupMorganMiddlewareForExpressWebAccessLogging">setupMorganMiddlewareForExpressWebAccessLogging</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupWinstonLogger">setupWinstonLogger</a></li></ul></li><li><a href="module-helpers_jrresult.html">helpers/jrresult</a></li><li><a href="module-models_app.html">models/app</a></li><li><a href="module-models_connection.html">models/connection</a></li><li><a href="module-models_file.html">models/file</a></li><li><a href="module-models_log.html">models/log</a></li><li><a href="module-models_login.html">models/login</a></li><li><a href="module-models_model_base_mongoose_minimal.html">models/model_base_mongoose_minimal</a></li><li><a href="module-models_modelBaseMongoose.html">models/modelBaseMongoose</a></li><li><a href="module-models_modqueue.html">models/modqueue</a></li><li><a href="module-models_option.html">models/option</a></li><li></li><li><a href="module-models_room.html">models/room</a></li><li><a href="module-models_roomdata.html">models/roomdata</a></li><li><a href="module-models_session.html">models/session</a></li><li><a href="module-models_subscription.html">models/subscription</a></li><li><a href="module-models_user.html">models/user</a></li><li><a href="module-models_verification.html">models/verification</a></li><li><a href="module-plugins_testplugin.html">plugins/testplugin</a></li><li></li><li></li><li><a href="module-routes_admin.html">routes/admin</a></li><li></li><li></li><li><a href="module-routes_analytics.html">routes/analytics</a></li><li><a href="module-routes_api_api.html">routes/api/api</a><ul class='methods'><li data-type='method'><a href="module-routes_api_api.html#~routerAllDos">routerAllDos</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllHello">routerAllHello</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllRefreshAccess">routerAllRefreshAccess</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllReqRefreshSession">routerAllReqRefreshSession</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllTokenTest">routerAllTokenTest</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerGetIndex">routerGetIndex</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerGetReqRefreshCredentials">routerGetReqRefreshCredentials</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerPostReqRefreshCredentials">routerPostReqRefreshCredentials</a></li><li data-type='method'><a href="module-routes_api_api.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_api_app.html">routes/api/app</a><ul class='methods'><li data-type='method'><a href="module-routes_api_app.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_api_roomdata.html">routes/api/roomdata</a><ul class='methods'><li data-type='method'><a href="module-routes_api_roomdata.html#~setupRouter">setupRouter</a></li><li data-type='method'><a href="module-routes_api_roomdata.html#~setupRouter">setupRouter</a></li></ul></li><li></li><li><a href="module-routes_app.html">routes/app</a></li><li></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_login.html">routes/login</a></li><li><a href="module-routes_logout.html">routes/logout</a></li><li><a href="module-routes_membersonly.html">routes/membersonly</a></li><li><a href="module-routes_profile.html">routes/profile</a></li><li><a href="module-routes_register.html">routes/register</a></li><li><a href="module-routes_room.html">routes/room</a></li><li><a href="module-routes_verify.html">routes/verify</a></li><li><a href="module-serverTests.html">serverTests</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">controllers/crudaid.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module controllers/crudaid
 * @author jesse reichler &lt;mouser@donationcoder.com>
 * @copyright 6/5/19
 * @description
 * This module defines CrudAid class, which provides support functions for crud (Create, Update, Delete, List) actions on model data in the database
 */

"use strict";


// modules
const fs = require("fs");
const path = require("path");

// modules
const hbs = require("hbs");


// requirement service locator
const jrequire = require("../helpers/jrequire");

// helpers
const JrContext = require("../helpers/jrcontext");
const jrhText = require("../helpers/jrh_text");
const jrhMisc = require("../helpers/jrh_misc");
const jrhGrid = require("../helpers/jrh_grid");
const jrdebug = require("../helpers/jrdebug");
const jrhExpress = require("../helpers/jrh_express");

// controllers
const arserver = jrequire("arserver");
// const aclAid = jrequire("aclaid");

// constants
const appdef = jrequire("appdef");




/**
 * Povides support functions for crud (Create, Update, Delete, List) actions on model data in the database
 *
 * @class CrudAid
 */
class CrudAid {

	//---------------------------------------------------------------------------
	// constructor
	constructor() {
	}
	//---------------------------------------------------------------------------




	//---------------------------------------------------------------------------
	/**
	 * Setup a router for a model's crud access (add/edit/view/list/delete)
	 *
	 * @param {*} router
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @memberof CrudAid
	 */
	setupRouter(router, modelClass, baseCrudUrl) {
		// this is called during server setup, for each route that we want to provide crud route support on
		// note that we use const variables with different names here so that we can precalc the view files ONCE
		// and use that calc'd path each time the request is made without having to recompute it


		const extraViewData = {};

		//---------------------------------------------------------------------------
		// list
		const viewFilePathList = this.calcViewFile("list", modelClass);
		router.get("/", async (req, res, next) => await this.handleListGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathList, extraViewData));
		// post for bulk operations
		router.post("/", async (req, res, next) => await this.handleListPost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathList, extraViewData));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// add (get)
		const viewFilePathAdd = this.calcViewFile("addedit", modelClass);
		router.get("/add/:id?", async (req, res, next) => await this.handleAddGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathAdd, extraViewData));
		// add (post submit)
		router.post("/add/:ignoredid?", async (req, res, next) => await this.handleAddPost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathAdd, extraViewData));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// edit (get)
		const viewFilePathEdit = this.calcViewFile("addedit", modelClass);
		router.get("/edit/:id", async (req, res, next) => await this.handleEditGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathEdit));
		// edit (post submit)
		router.post("/edit/:ignoredid?", async (req, res, next) => await this.handleEditPost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathEdit, extraViewData));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// view (get)
		const viewFilePathView = this.calcViewFile("viewdelete", modelClass);
		router.get("/view/:id", async (req, res, next) => await this.handleViewGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathView, extraViewData));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// delete (get)
		const viewFilePathDelete = this.calcViewFile("viewdelete", modelClass);
		router.get("/delete/:id", async (req, res, next) => await this.handleChangeModeGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathDelete, extraViewData, "delete"));
		// delete (post submit)
		router.post("/delete/:ignoredid?", async (req, res, next) => await this.handleChangeModePost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathDelete, extraViewData, "delete"));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// PermDelete (get)
		const viewFilePathPermDelete = this.calcViewFile("viewdelete", modelClass);
		router.get("/permdelete/:id", async (req, res, next) => await this.handleChangeModeGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathPermDelete, extraViewData, "permdelete"));
		// PermDelete (post submit)
		router.post("/permdelete/:ignoredid?", async (req, res, next) => await this.handleChangeModePost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathPermDelete, extraViewData, "permdelete"));
		//---------------------------------------------------------------------------

		//---------------------------------------------------------------------------
		// UNdelete (get)
		const viewFilePathUnDelete = this.calcViewFile("viewdelete", modelClass);
		router.get("/undelete/:id", async (req, res, next) => await this.handleChangeModeGet(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathUnDelete, extraViewData, "undelete"));
		// UNdelete (post submit)
		router.post("/undelete/:ignoredid?", async (req, res, next) => await this.handleChangeModePost(JrContext.makeNew(req, res, next), modelClass, baseCrudUrl, viewFilePathUnDelete, extraViewData, "undelete"));
		//---------------------------------------------------------------------------


	}
	//---------------------------------------------------------------------------








	//---------------------------------------------------------------------------
	// These functions do the actual work of crud routes

	/**
	 * Route invokes this on a list get route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on route handled
	 * @memberof CrudAid
	 */
	async handleListGet(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// acl test
		if (!await arserver.aclRequireModelAccessRenderErrorPageOrRedirect(jrContext, user, modelClass, appdef.DefAclActionList)) {
			return true;
		}

		// present the list
		return await this.doPresentListForm(jrContext, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
	}


	/**
	 * Route invokes this on a list post route, which happens when user performs bulk actions on list view
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on route handled
	 * @memberof CrudAid
	 */
	async handleListPost(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// this is called for bulk action

		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// acl test
		if (!await arserver.aclRequireModelAccessRenderErrorPageOrRedirect(jrContext, user, modelClass, appdef.DefAclActionList)) {
			return true;
		}
		// check required csrf token
		arserver.testCsrf(jrContext);
		if (!jrContext.isError()) {
			// get bulk action options
			const formbody = jrContext.req.body;
			const bulkAction = formbody.bulkaction;
			// get all checked checkboxes
			const checkboxIdList = jrhExpress.reqPrefixedCheckboxItemIds(formbody, "checkboxid_");

			// do the bulk action and add result to session
			await this.doBulkAction(jrContext, user, modelClass, bulkAction, checkboxIdList);
		}

		// add result (error or result of bulk action) to session? NO because we include when we present the form, and this addToSession is only for when we redirect, etc.
		// jrContext.addToThisSession();

		// present the list
		return await this.doPresentListForm(jrContext, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
	}




	/**
	 * Shared function for handling list route (get and post)
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} user
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async doPresentListForm(jrContext, user, modelClass, baseCrudUrl, viewFileSet, extraViewData) {

		// ATTN: We might set these differently based on who is logged in and looking at the list
		// and it should be a per-modelClass thing..
		// ATTN: testing here some manual items:
		const protectedFields = ["passwordHashed"];
		let hiddenFields = [];

		// parse view file set
		const { viewFile, isGeneric } = viewFileSet;

		// hidden fields for list view
		const hiddenFiledsSchema = await modelClass.calcHiddenSchemaKeysForView(jrContext, "list");
		hiddenFields = jrhMisc.mergeArraysDedupe(hiddenFields, hiddenFiledsSchema);

		// make helper data
		const helperData = await modelClass.calcCrudListHelperData(jrContext, user, baseCrudUrl, protectedFields, hiddenFields);

		// generic main html for page (add form)
		let genericMainHtml;
		if (isGeneric) {
			genericMainHtml = await this.buildGenericMainHtmlList(jrContext, helperData);
			genericMainHtml = new hbs.SafeString(genericMainHtml);
		}

		// render
		const jrResult = jrContext.mergeSessionMessages();
		jrContext.res.render(viewFile, {
			headline: modelClass.getNiceName() + " List",
			jrResult,
			csrfToken: arserver.makeCsrf(jrContext),
			helperData,
			genericMainHtml,
			baseCrudUrl,
			extraViewData,
		});

		return true;
	}
	//---------------------------------------------------------------------------























	//---------------------------------------------------------------------------
	/**
	 * Handles get add route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleAddGet(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);
		let reqbody;

		// acl test to add
		if (!await arserver.aclRequireModelAccessRenderErrorPageOrRedirect(jrContext, user, modelClass, appdef.DefAclActionAdd)) {
			return true;
		}

		// present form
		await this.doPresentAddForm(jrContext, reqbody, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
		return true;
	}


	/**
	 * Handles post add route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleAddPost(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// user posts form for adding submission

		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		const formTypeStr = "add";
		const flagRepresentAfterSuccess = false;
		let reqbody = jrContext.req.body;

		// acl test
		if (!await arserver.aclRequireModelAccessRenderErrorPageOrRedirect(jrContext, user, modelClass, appdef.DefAclActionAdd)) {
			return true;
		}


		// load existing object by id if provided, throw errors if id missing (or provided to add formtype)
		// in the ADD case, this should just return a new blank object or complain if user specified an id
		const obj = await modelClass.validateAddEditFormIdMakeObj(jrContext, formTypeStr);
		// add creator
		obj.creator = user.getIdAsString();


		if (!jrContext.isError()) {
			// check required csrf token
			arserver.testCsrf(jrContext);
		}

		if (!jrContext.isError()) {
			// now save add changes
			// form fields that we dont complain about finding even though they arent for the form object
			const ignoreFields = this.getCrudEditFormIgnoreFields();

			// process

			const saveFields = modelClass.getSaveFields("crudAdd");
			let savedobj = await modelClass.validateSave(jrContext, {}, true, user, jrContext.req.body, saveFields, null, ignoreFields, obj, modelClass.getShouldBeOwned());
			if (!jrContext.isError()) {
				// success! drop down with new blank form, or alternatively, we could redirect to a VIEW obj._id page
				jrContext.pushSuccess(modelClass.getNiceName() + " added on " + jrhMisc.getNiceNowString() + ".");

				// log the action
				arserver.logr(jrContext, "crud.create", "created " + savedobj.getLogIdString());

				if (jrContext.isError()) {
					// we had an error saving user; this is serious because it leaves an orphaned object
					let errmsg = "There was an error saving the new owner role for " + user.getLogIdString() + " after creation of new object " + savedobj.getLogIdString() + ": " + jrContext.getErrorsAsString() + ".";
					// so first things first lets delete the object
					// we do a REAL delete here (as opposed to a virtual one) since the object was just added in failure
					// NOTE: we create a new context with no errors in it for this, so we can better check if this operations errors
					const jrContextFollowup = JrContext.makeNew(jrContext.req, jrContext.res, jrContext.next);
					await savedobj.doChangeMode(jrContextFollowup, appdef.DefMdbRealDelete);
					if (jrContextFollowup.isError()) {
						// yikes we couldn't even delete the object
						errmsg += "  In addition, the newly created object could not be rolled back and deleted: " + jrContextFollowup.getErrorsAsString();
					} else {
						// at least we rolled back the object
						errmsg += "  But the newly created object was successfully rolled back and deleted.";
					}
					// now log error
					arserver.logr(jrContext, appdef.DefLogTypeErrorCriticalDb, errmsg);

					// clear object
					savedobj = null;
				}


				if (!jrContext.isError()) {
					if (!baseCrudUrl) {
						// just return to caller saying they should take over
						return false;
					}

					if (flagRepresentAfterSuccess) {
						// success, so clear reqbody and drop down so they can add another
						reqbody = {};
					} else {
						jrContext.addToThisSession();
						jrContext.res.redirect(baseCrudUrl + "/view/" + savedobj.getIdAsString());
						return true;
					}
				}
			}
		}

		if (jrContext.isError()) {
			// error, so we need to fetch object for edit refinement..
		}

		// re-present form
		await this.doPresentAddForm(jrContext, reqbody, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
		return true;
	}


	/**
	 * Shared function for handling add request (get and post)
	 *
	 * @param {*} req
	 * @param {*} reqbody
	 * @param {*} jrResult
	 * @param {*} res
	 * @param {*} user
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @memberof CrudAid
	 */
	async doPresentAddForm(jrContext, reqbody, user, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// any helper data
		const helperData = await modelClass.calcCrudEditHelperData(user);

		// parse view file set
		const { viewFile, isGeneric } = viewFileSet;

		// generic main html for page (add form)
		let genericMainHtml;
		if (isGeneric) {
			const obj = null;
			genericMainHtml = await this.buildGenericMainHtmlAddEditView(jrContext, null, "add", modelClass, obj, reqbody, helperData);
			genericMainHtml = new hbs.SafeString(genericMainHtml);
		}

		// cancel button goes where?
		const cancelUrl = baseCrudUrl;

		// re-present form for another add?
		jrContext.res.render(viewFile, {
			headline: "Add " + modelClass.getNiceName(),
			jrResult: jrContext.mergeSessionMessages(),
			csrfToken: arserver.makeCsrf(jrContext),
			reqbody,
			helperData,
			genericMainHtml,
			baseCrudUrl,
			cancelUrl,
			crudAdd: true,
			extraViewData,
			id: null,
		});

	}
	//---------------------------------------------------------------------------




	//---------------------------------------------------------------------------
	/**
	 * 	 * Handles get edit route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleEditGet(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// get id from get param
		const id = jrContext.req.params.id;

		// validate and get id, this will also do an ACL test
		const obj = await modelClass.validateGetObjByIdDoAclRenderErrorPageOrRedirect(jrContext, user, id, appdef.DefAclActionEdit);
		if (jrContext.isError()) {
			return false;
		}

		// present form
		return await this.doPresentEditForm(jrContext, null, obj, id, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
	}


	/**
	 * Handles post edit route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handle
	 * @memberof CrudAid
	 */
	async handleEditPost(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// user posts form for adding submission

		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// ATTN: in post of edit, we ignore the id passed in param and get it from post body
		const formTypeStr = "edit";
		const flagRepresentAfterSuccess = false;
		let reqbody = jrContext.req.body;

		// get id from post, ignore url param
		const id = jrContext.req.body._editId;
		const ignoreFields = this.getCrudEditFormIgnoreFields();

		// acl test
		if (!await arserver.aclRequireModelAccessRenderErrorPageOrRedirect(jrContext, user, modelClass, appdef.DefAclActionEdit, id)) {
			return false;
		}
		// form fields that we dont complain about finding even though they arent for the form object

		// load existing object by id if provided, throw errors if id missing (or provided to add formtype)
		const obj = await modelClass.validateAddEditFormIdMakeObj(jrContext, formTypeStr);

		if (!jrContext.isError()) {
			// check required csrf token
			arserver.testCsrf(jrContext);
		}

		if (!jrContext.isError()) {
			// now save edit changes
			const saveFields = modelClass.getSaveFields("crudEdit");
			const savedobj = await modelClass.validateSave(jrContext, {}, true, user, jrContext.req.body, saveFields, null, ignoreFields, obj, modelClass.getShouldBeOwned());

			if (!jrContext.isError()) {
				// success! drop down with new blank form, or alternatively, we could redirect to a VIEW obj._id page

				// log the action
				const idLabel = savedobj.getLogIdString();
				arserver.logr(jrContext, "crud.edit", "edited " + idLabel);

				// success message
				jrContext.pushSuccess(modelClass.getNiceName() + " saved on " + jrhMisc.getNiceNowString() + ".");
				if (!baseCrudUrl) {
					// just return to caller saying they should take over
					jrContext.addToThisSession();
					// ATTN: todo -- check if this return leads to failure to render/redirect any page?
					return false;
				}

				if (flagRepresentAfterSuccess) {
					reqbody = null;
				} else {
					jrContext.addToThisSession();
					jrContext.res.redirect(baseCrudUrl + "/view/" + savedobj.getIdAsString());
					return true;
				}
			}
		}

		// re-present form
		return await this.doPresentEditForm(jrContext, reqbody, obj, id, user, modelClass, baseCrudUrl, viewFileSet, extraViewData);
	}


	/**
	 * Common presentation of edit form
	 *
	 * @param {*} req
	 * @param {*} reqbody
	 * @param {*} jrResult
	 * @param {*} obj
	 * @param {*} id
	 * @param {*} res
	 * @param {*} user
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async doPresentEditForm(jrContext, reqbody, obj, id, user, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// any helper data
		const helperData = await modelClass.calcCrudEditHelperData(user, id);

		// parse view file set
		const { viewFile, isGeneric } = viewFileSet;

		// generic main html for page (edit form)
		let genericMainHtml;
		if (isGeneric) {
			genericMainHtml = await this.buildGenericMainHtmlAddEditView(jrContext, id, "edit", modelClass, obj, reqbody, helperData);
			genericMainHtml = new hbs.SafeString(genericMainHtml);
		}

		//
		const flagOfferDelete = modelClass.getDefaultDeleteDisableModeIsVirtual() &amp;&amp; (obj.disabled === 0 || (obj.disabled !== appdef.DefMdbVirtDelete));
		const flagOfferUnDelete = obj.disabled === appdef.DefMdbVirtDelete;
		const flagOfferPermDelete = true;

		// cancel button goes where?
		const cancelUrl = baseCrudUrl + "/view/" + id;


		// render
		jrContext.res.render(viewFile, {
			headline: "Edit " + modelClass.getNiceName() + " #" + id,
			jrResult: jrContext.mergeSessionMessages(),
			csrfToken: arserver.makeCsrf(jrContext),
			reqbody,
			helperData,
			genericMainHtml,
			baseCrudUrl,
			cancelUrl,
			extraViewData,
			flagOfferDelete,
			flagOfferPermDelete,
			flagOfferUnDelete,
			id,
		});

		return true;
	}
	//---------------------------------------------------------------------------









	//---------------------------------------------------------------------------
	/**
	 * Handle get view route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleViewGet(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData) {
		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// get id from get param
		const id = jrContext.req.params.id;

		// get obj AND perform acl test
		const obj = await modelClass.validateGetObjByIdDoAclRenderErrorPageOrRedirect(jrContext, user, id, appdef.DefAclActionView);
		if (jrContext.isError()) {
			return true;
		}

		// any helper data
		const helperData = await modelClass.calcCrudViewHelperData(jrContext, id, obj);

		// parse view file set
		const { viewFile, isGeneric } = viewFileSet;

		// generic main html for page (view form)
		let genericMainHtml;
		if (isGeneric) {
			const reqbody = null;
			genericMainHtml = await this.buildGenericMainHtmlAddEditView(jrContext, id, "view", modelClass, obj, reqbody, helperData);
			genericMainHtml = new hbs.SafeString(genericMainHtml);
		}

		const flagOfferDelete = modelClass.getDefaultDeleteDisableModeIsVirtual() &amp;&amp; (obj.disabled === 0 || (obj.disabled !== appdef.DefMdbVirtDelete));
		const flagOfferUnDelete = obj.disabled === appdef.DefMdbVirtDelete;
		const flagOfferPermDelete = true;

		// render
		jrContext.res.render(viewFile, {
			headline: "View " + modelClass.getNiceName() + " #" + id,
			jrResult: jrContext.mergeSessionMessages(),
			obj,
			helperData,
			genericMainHtml,
			reqmode: "view",
			flagOfferDelete,
			flagOfferPermDelete,
			flagOfferUnDelete,
			baseCrudUrl,
			extraViewData,
		});

		return true;
	}




	/**
	 * Helper function that validated the change mode string and returns the ACL action associated with it or throws error
	 *
	 * @param {*} reqmode
	 * @returns the acl action string or null on error; error pushed to jrResult
	 * @memberof CrudAid
	 */
	getAclActionForChangeReqMode(jrContext, modelClass, reqmode) {
		if (reqmode === "virtdelete") {
			if (modelClass.supportsVirtualDelete()) {
				return appdef.DefAclActionDelete;
			}
			jrContext.pushError("Virtual delete not supported for model class " + modelClass.getNiceName());
			return null;
		}
		if (reqmode === "delete") {
			// this will either be a virtual delete or a permanent delete
			// return appdef.DefAclActionDelete;
			return modelClass.getDefaultDeleteDisableModeAsAclAction();
		}
		if (reqmode === "permdelete") {
			return appdef.DefAclActionPermDelete;
		}
		if (reqmode === "undelete") {
			return appdef.DefAclActionUnDelete;
		}
		// error
		jrContext.pushError("Unknown reqmode in getAclActionForChangeReqMode: " + reqmode);
		return null;
	}



	/**
	 * Given a change mode acl action return the database mode change value it represents
	 *
	 * @param {*} aclAction
	 * @param {*} jrResult
	 * @returns appdef.DefMdbVirtDelete or appdef.DefMdbRealDelete or appdef.DefMdbEnable
	 * @memberof CrudAid
	 */
	convertAclChangeModeActionToDeleteDatabaseStateValue(jrContext, aclAction) {
		// what kind of delete do we want, virtual or real?
		if (aclAction === appdef.DefAclActionDelete) {
			return appdef.DefMdbVirtDelete;
		}
		if (aclAction === appdef.DefAclActionPermDelete) {
			return appdef.DefMdbRealDelete;
		}
		if (aclAction === appdef.DefAclActionUnDelete) {
			return appdef.DefMdbEnable;
		}
		jrContext.pushError("Unknown aclAction in convertAclChangeModeActionToDeleteDatabaseStateValue: " + aclAction);
		return null;
	}




	/**
	 * Handle get chagemode route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @param {*} reqmode
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleChangeModeGet(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData, reqmode) {
		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// get id from get param
		const id = jrContext.req.params.id;
		let obj;

		// which acl permission to check for
		const aclAction = this.getAclActionForChangeReqMode(jrContext, modelClass, reqmode);

		// get object AND perform ACL test
		if (!jrContext.isError()) {
			obj = await modelClass.validateGetObjByIdDoAclRenderErrorPageOrRedirect(jrContext, user, id, aclAction);
		}

		return await this.doPresentChangeModeForm(jrContext, id, obj, modelClass, baseCrudUrl, viewFileSet, extraViewData, reqmode);
	}



	/**
	 * 	 * Handle post chagemode route
	 *
	 * @param {*} req
	 * @param {*} res
	 * @param {*} next
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @param {*} reqmode
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async handleChangeModePost(jrContext, modelClass, baseCrudUrl, viewFileSet, extraViewData, reqmode) {

		// get logged in user
		const user = await arserver.lookupLoggedInUser(jrContext);

		// get id from post, ignore url param
		const id = jrContext.req.body._editId;
		let obj, newmode;

		// ATTN: change this to drop down re-present rather than error
		// check required csrf token
		arserver.testCsrf(jrContext);

		if (!jrContext.isError()) {
			// which acl permission to check for
			const aclAction = this.getAclActionForChangeReqMode(jrContext, modelClass, reqmode);

			if (!jrContext.isError()) {
				// get object AND perform ACL test
				obj = await modelClass.validateGetObjByIdDoAclRenderErrorPageOrRedirect(jrContext, user, id, aclAction);
			}

			if (!jrContext.isError()) {
				// process delete
				newmode = this.convertAclChangeModeActionToDeleteDatabaseStateValue(jrContext, aclAction);
			}

			if (!jrContext.isError()) {
				// do the actual mode change (delete / virtual or real)
				await obj.doChangeMode(jrContext, newmode);
			}
		}


		// on success redirect to listview
		if (!jrContext.isError()) {
			// success (push message to top since helper deleted may have been pushed on earlier)
			const objIdString = obj.getIdAsString();
			jrContext.pushSuccess(modelClass.getNiceName() + " #" + objIdString + " has been " + appdef.DefStateModeLabels[newmode] + ".", true);

			// log the action
			const logIdString = obj.getLogIdString();
			arserver.logr(jrContext, "crud." + reqmode, appdef.DefStateModeLabels[newmode] + " " + logIdString);

			// redirect
			jrContext.addToThisSession();
			jrContext.res.redirect(baseCrudUrl);
			return true;
		}

		// error, re-present form
		return await this.doPresentChangeModeForm(jrContext, id, obj, modelClass, baseCrudUrl, viewFileSet, extraViewData, reqmode);
	}



	/**
	 * Present the form that lets user change the mode (deleted, etc.)
	 *
	 * @param {*} id
	 * @param {*} obj
	 * @param {*} req
	 * @param {*} res
	 * @param {*} modelClass
	 * @param {*} baseCrudUrl
	 * @param {*} viewFileSet
	 * @param {*} extraViewData
	 * @param {*} reqmode
	 * @returns true on handled
	 * @memberof CrudAid
	 */
	async doPresentChangeModeForm(jrContext, id, obj, modelClass, baseCrudUrl, viewFileSet, extraViewData, reqmode) {

		// any helper data
		const helperData = await modelClass.calcCrudViewHelperData(jrContext, id, obj);

		// parse view file set
		const { viewFile, isGeneric } = viewFileSet;

		// generic main html for page (delete form)
		let genericMainHtml;
		if (isGeneric) {
			const reqbody = null;
			genericMainHtml = await this.buildGenericMainHtmlAddEditView(jrContext, id, "view", modelClass, obj, reqbody, helperData);
			genericMainHtml = new hbs.SafeString(genericMainHtml);
		}

		// cancel button goes where?
		const cancelUrl = baseCrudUrl + "/view/" + id;

		//
		const flagConfirmDelete = (reqmode === "delete");
		const flagConfirmPermDelete = (reqmode === "permdelete");
		const flagConfirmUnDelete = (reqmode === "undelete");

		// render
		jrContext.res.render(viewFile, {
			headline: "Confirmation required.\n" + jrhText.capitalizeFirstLetter(reqmode) + " " + modelClass.getNiceName() + " #" + id + "?",
			jrResult: jrContext.mergeSessionMessages(),
			csrfToken: arserver.makeCsrf(jrContext),
			obj,
			genericMainHtml,
			flagConfirmDelete,
			flagConfirmPermDelete,
			flagConfirmUnDelete,
			baseCrudUrl,
			cancelUrl,
			extraViewData,
		});

		return true;
	}

	//---------------------------------------------------------------------------




















	//---------------------------------------------------------------------------
	/**
	 * Helper for parsing crud forms
	 *
	 * @returns	array list of fields that we dont need to complain about and just ignore when they are found in an edit form submission
	 * @memberof CrudAid
	 */
	getCrudEditFormIgnoreFields() {
		return ["_csrf", "_editId", "emailBypassVerify"];
	}
	//---------------------------------------------------------------------------







	//---------------------------------------------------------------------------
	/**
	 * Helper function that calculates the view file to be used for different routes
	 * Checks first for model specific view, then defaults to crud generic if the specific one not found.
	 *
	 * @param {*} subview
	 * @param {*} modelClass
	 * @returns object with .viewfile and .isGeneric fields
	 * @memberof CrudAid
	 */
	calcViewFile(subview, modelClass) {
		const fname = path.join("crud", subview);
		const fnameModelSpecific = path.join("crud", modelClass.getCollectionName() + "_" + subview);
		const fnameModelGeneric = path.join("crud", "generic_" + subview);
		// try to find model specific version
		const fpath = path.join(arserver.getViewPath(), fnameModelSpecific + arserver.getViewExt());
		if (fs.existsSync(fpath)) {
			return {
				viewFile: fnameModelSpecific,
				isGeneric: false,
			};
		}
		return {
			viewFile: fnameModelGeneric,
			isGeneric: true,
		};
	}
	//---------------------------------------------------------------------------





















	//---------------------------------------------------------------------------
	/**
	 * NEW
	 * Generate the main html for add/edit/view crudSubType view
	 *
	 * @param {*} crudSubType
	 * @param {*} modelClass
	 * @param {*} req
	 * @param {*} obj
	 * @param {*} helperData
	 * @param {*} jrResult
	 * @returns html string
	 * @memberof CrudAid
	 */
	async buildGenericMainHtmlAddEditView(jrContext, id, crudSubType, modelClass, obj, editData, helperData) {
		let rethtml = "";

		// start table
		rethtml += `
		&lt;div class="table-responsive">
		&lt;table class="table table-striped w-auto table-bordered">
		`;

		// add id
		if (id) {
			rethtml += `&lt;input type="hidden" id="_editId" name="_editId" value="${id}">`;
		}

		// schema for obj
		const modelSchema = modelClass.getSchemaDefinition();
		const schemaKeys = Object.keys(modelSchema);
		let schemaType;
		let val, valHtml, label, valueFunction, hideList, readOnlyList, choices;
		let visibleFunction, isVisible, isReadOnly;
		let extra;
		let err;

		await jrhMisc.asyncAwaitForEachFunctionCall(schemaKeys, async (fieldName) => {

			// type of this field
			schemaType = modelClass.getBaseSchemaType(fieldName);

			// hidden?
			hideList = modelClass.getSchemaFieldVal(fieldName, "hide", undefined);
			if ((hideList === true) || jrhMisc.isInAnyArray(crudSubType, hideList)) {
				return;
			}
			// dynamic visibility function
			visibleFunction = modelClass.getSchemaFieldVal(fieldName, "visibleFunction");
			if (visibleFunction) {
				// ok we have a custom function to call
				isVisible = await visibleFunction(jrContext, crudSubType, fieldName, obj, editData, helperData);
				if (!isVisible) {
					return;
				}
			}

			// label
			label = modelClass.getSchemaFieldVal(fieldName, "label", fieldName);

			// html value to display (may be an input element if in edit crudSubType)
			valHtml = await modelClass.renderFieldValueHtml(jrContext, obj, editData, fieldName, crudSubType, helperData);

			// add any error
			err = jrContext.getFieldError(fieldName, "");

			// render it
			rethtml += `
			&lt;tr>
        		&lt;td>&lt;strong>${label}&lt;/strong>&lt;/td>
					  &lt;td>${valHtml}`;

			if (err) {
				rethtml += ` &lt;span class="jrErrorInline">${err}&lt;/span> `;
			}

			rethtml += ` &lt;/td>
			&lt;/tr>
			`;
		});

		// end table
		rethtml += `
		&lt;/table>
		&lt;/div>
		`;

		return rethtml;
	}
	//---------------------------------------------------------------------------





	//---------------------------------------------------------------------------
	/**
	 * Generate the main html for LIST view crudSubType view
	 *
	 * @param {*} modelClass
	 * @param {*} req
	 * @param {*} obj
	 * @param {*} jrResult
	 * @param {*} crudSubType
	 * @param {*} helperData
	 * @returns html string
	 * @memberof CrudAid
	 */
	async buildGenericMainHtmlList(jrContext, helperData) {
		const csrfToken = arserver.makeCsrf(jrContext);
		const rehtml = await jrhGrid.jrGridList(jrContext, helperData, csrfToken);
		return rehtml;
	}
	//---------------------------------------------------------------------------










	//---------------------------------------------------------------------------
	/**
	 * Before a bulk action (deleting, etc).
	 *
	 * @param {*} user
	 * @param {*} modelClass
	 * @param {*} bulkAction
	 * @param {*} idList
	 * @returns jrResult
	 * @memberof CrudAid
	 */
	async doBulkAction(jrContext, user, modelClass, bulkAction, idList) {

		if (bulkAction === "disable") {
			// do they have permission to delete all in the list
			const permission = appdef.DefAclActionDisable;
			const objectType = modelClass.getAclName();
			if (!await user.aclHasPermissionOnAll(jrContext, permission, objectType, idList)) {
				jrContext.pushError("Permission denied; you do not have permission to " + bulkAction + " these items.");
				return;
			}

			// they have permission!

			// what kind of delete should we do? real or virtual?
			const mode = appdef.DefMdbDisable;
			await modelClass.doChangeModeByIdList(jrContext, idList, mode, false);
			return;
		}

		if (bulkAction === "enable") {
			// do they have permission to delete all in the list
			const permission = appdef.DefAclActionEnable;
			const objectType = modelClass.getAclName();
			if (!await user.aclHasPermissionOnAll(jrContext, permission, objectType, idList)) {
				jrContext.pushError("Permission denied; you do not have permission to " + bulkAction + " these items.");
				return;
			}

			// they have permission!

			// what kind of delete should we do? real or virtual?
			const mode = appdef.DefMdbEnable;
			await modelClass.doChangeModeByIdList(jrContext, idList, mode, false);
			return;
		}


		if (bulkAction === "delete") {
			// do they have permission to delete all in the list
			const permission = appdef.DefAclActionDelete;
			const objectType = modelClass.getAclName();
			if (!await user.aclHasPermissionOnAll(jrContext, permission, objectType, idList)) {
				jrContext.pushError("Permission denied; you do not have permission to " + bulkAction + " these items.");
				return;
			}

			// they have permission!

			// what kind of delete should we do? real or virtual?
			const mode = modelClass.getDefaultDeleteDisableMode();

			await modelClass.doChangeModeByIdList(jrContext, idList, mode, false);
			return;
		}

		if (bulkAction === "permdelete") {
			// do they have permission to delete all in the list
			const permission = appdef.DefAclActionPermDelete;
			const objectType = modelClass.getAclName();
			if (!await user.aclHasPermissionOnAll(jrContext, permission, objectType, idList)) {
				jrContext.pushError("Permission denied; you do not have permission to " + bulkAction + " these items.");
				return;
			}

			// they have permission!

			// real permanent delete
			const mode = appdef.DefMdbRealDelete;

			await modelClass.doChangeModeByIdList(jrContext, idList, mode, false);
			return;
		}

		if (bulkAction === "undelete") {
			// do they have permission to undelete all in the list
			const permission = appdef.DefAclActionUnDelete;
			const objectType = modelClass.getAclName();
			if (!await user.aclHasPermissionOnAll(jrContext, permission, objectType, idList)) {
				jrContext.pushError("Permission denied; you do not have permission to " + bulkAction + " these items.");
				return;
			}

			// they have permission!

			// undelete means make enabled
			const mode = appdef.DefMdbEnable;

			await modelClass.doChangeModeByIdList(jrContext, idList, mode, false);
			return;
		}


		// dont know this bulk action
		jrContext.pushError("Internal error - unknown bulk operation [" + bulkAction + "]");
	}
	//---------------------------------------------------------------------------










}





// export the class as the sole export
module.exports = new CrudAid();
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Sun Jun 21 2020 11:32:01 GMT-0500 (Central Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
