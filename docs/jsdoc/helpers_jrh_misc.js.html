<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>helpers/jrh_misc.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JrResult.JrResult.html">JrResult</a></li><li><a href="module-controllers_aclaid-AclAid.html">AclAid</a></li><li><a href="module-controllers_adminaid-AdminAid.html">AdminAid</a></li><li><a href="module-controllers_arserver-AppRoomServer.html">AppRoomServer</a></li><li><a href="module-controllers_crudaid-CrudAid.html">CrudAid</a></li><li><a href="module-controllers_ratelimiteraid-RateLimiterAid.html">RateLimiterAid</a></li><li><a href="module-controllers_registrationaid-RegistrationAid.html">RegistrationAid</a></li><li><a href="module-helpers_jrresult-JrResult.html">JrResult</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#._unusedCodeExpressMiddlewareInjectSessionResult">_unusedCodeExpressMiddlewareInjectSessionResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.getMergeSessionResultAndClear">getMergeSessionResultAndClear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isJrResult">isJrResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeAndRemoveFromSession">makeAndRemoveFromSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeClone">makeClone</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeError">makeError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeMessage">makeMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeNew">makeNew</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeSuccess">makeSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.passportOrJrResultErrorAsString">passportOrJrResultErrorAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.undefinedIfBlank">undefinedIfBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#addToSession">addToSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clear">clear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clearSection">clearSection</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getDoneRendering">getDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getErrorsAsString">getErrorsAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getExtraData">getExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getFieldError">getFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getType">getType</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#isError">isError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#mergeIn">mergeIn</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#push">push</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushBiFieldError">pushBiFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushError">pushError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushErrorOnTop">pushErrorOnTop</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushFieldError">pushFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushMessage">pushMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushSuccess">pushSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setDoneRendering">setDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setError">setError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setExtraData">setExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setFieldError">setFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setType">setType</a></li></ul></li><li><a href="module-models_app-AppModel.html">AppModel</a></li><li><a href="module-models_connection-ConnectionModel.html">ConnectionModel</a></li><li><a href="module-models_file-FileModel.html">FileModel</a></li><li><a href="module-models_login-LoginModel.html">LoginModel</a></li><li><a href="module-models_log-LogModel.html">LogModel</a></li><li><a href="module-models_model_base_mongoose_minimal-ModelBaseMongooseMinimal.html">ModelBaseMongooseMinimal</a></li><li><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html">ModelBaseMongoose</a></li><li><a href="module-models_option-OptionModel.html">OptionModel</a></li><li><a href="module-models_roomdata-RoomdataModel.html">RoomdataModel</a></li><li><a href="module-models_room-RoomModel.html">RoomModel</a></li><li><a href="module-models_session-SessionModel.html">SessionModel</a></li><li><a href="module-models_user-UserModel.html">UserModel</a></li><li><a href="module-models_verification-VerificationModel.html">VerificationModel</a></li></ul><h3>Modules</h3><ul><li><a href="module-approomglobals.html">approomglobals</a><ul class='methods'><li data-type='method'><a href="module-approomglobals.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-approomTest.html">approomTest</a></li><li><a href="module-controllers_aclaid.html">controllers/aclaid</a></li><li><a href="module-controllers_adminaid.html">controllers/adminaid</a></li><li><a href="module-controllers_arserver.html">controllers/arserver</a></li><li><a href="module-controllers_crudaid.html">controllers/crudaid</a></li><li><a href="module-controllers_jrequireaid.html">controllers/jrequireaid</a></li><li><a href="module-controllers_ratelimiteraid.html">controllers/ratelimiteraid</a></li><li><a href="module-controllers_registrationaid.html">controllers/registrationaid</a></li><li><a href="module-helpers_jrconfig.html">helpers/jrconfig</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrconfig.html#~addConfigFile">addConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~findQueuedCommand">findQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~fixConfigFilePathName">fixConfigFilePathName</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugObj">getDebugObj</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getVal">getVal</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getValDefault">getValDefault</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~ipStringToSafeFilenameString">ipStringToSafeFilenameString</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeCliConfigFiles">nconfMergeCliConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeConfigFile">nconfMergeConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~parse">parse</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~popQueuedCommand">popQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~queueYargsCommand">queueYargsCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~runQueuedCommands">runQueuedCommands</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setConfigDirAndDiscoverFiles">setConfigDirAndDiscoverFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setDefaultOptions">setDefaultOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setEnvList">setEnvList</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setOverrideOptions">setOverrideOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setServerFilenamePrefixFromServerIp">setServerFilenamePrefixFromServerIp</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setYargs">setYargs</a></li></ul></li><li><a href="module-helpers_jrdebug.html">helpers/jrdebug</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebug">cdebug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugf">cdebugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugObj">cdebugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debug">debug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugf">debugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugObj">debugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~getDebugEnabled">getDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setDebugEnabled">setDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setupDebugmod">setupDebugmod</a></li></ul></li><li><a href="module-helpers_jrequire.html">helpers/jrequire</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrequire.html#~calcDebugInfo">calcDebugInfo</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~jrequire">jrequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerPath">registerPath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerRequire">registerRequire</a></li></ul></li><li><a href="module-helpers_jrh_crypto.html">helpers/jrh_crypto</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_crypto.html#~createHashedObjectFromString">createHashedObjectFromString</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~generateRandomSalt">generateRandomSalt</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHex">genRandomStringHex</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasier">genRandomStringHumanEasier</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasy">genRandomStringHumanEasy</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextPasswordToObj">hashPlaintextPasswordToObj</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextStringInsecureButSearchable">hashPlaintextStringInsecureButSearchable</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~testPlaintextPassword">testPlaintextPassword</a></li></ul></li><li><a href="module-helpers_jrh_express.html">helpers/jrh_express</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordAuthenticate">asyncPasswordAuthenticate</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordReqLogin">asyncPasswordReqLogin</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddleWare">calcExpressMiddleWare</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathData">calcExpressRoutePathData</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataRouteArray">calcExpressRoutePathDataRouteArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataSplit">calcExpressRoutePathDataSplit</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~forgetSessionVar">forgetSessionVar</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~normalizePort">normalizePort</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedValueArray">reqPrefixedValueArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqVal">reqVal</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValAsInt">reqValAsInt</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValFromList">reqValFromList</a></li></ul></li><li><a href="module-helpers_jrh_grid.html">helpers/jrh_grid</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_grid.html#~calcHeaderKeysNicely">calcHeaderKeysNicely</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridList">jrGridList</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPager">jrGridListPager</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItem">jrGridListPagerItem</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItemPerPage">jrGridListPagerItemPerPage</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTable">jrGridListTable</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableData">jrGridListTableData</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeader">jrGridListTableHeader</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeaderSortDir">jrGridListTableHeaderSortDir</a></li></ul></li><li><a href="module-helpers_jrh_handlebars.html">helpers/jrh_handlebars</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~loadPartialFiles">loadPartialFiles</a></li><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~setupJrHandlebarHelpers">setupJrHandlebarHelpers</a></li></ul></li><li><a href="module-helpers_jrh_misc.html">helpers/jrh_misc</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncAwaitForEachFunctionCall">asyncAwaitForEachFunctionCall</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~createObjectFromJsonParse">createObjectFromJsonParse</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~DateNowPlusMinutes">DateNowPlusMinutes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~deepIterationCopy">deepIterationCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~findLongestPrefixAndRemainder">findLongestPrefixAndRemainder</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~firstCoercedTrueValue">firstCoercedTrueValue</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceNowString">getNiceNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonFalseValueOrDefault">getNonFalseValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueOrDefault">getNonNullValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getPreciseNowString">getPreciseNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getServerIpAddress">getServerIpAddress</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isInAnyArray">isInAnyArray</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectEmpty">isObjectEmpty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isPromise">isPromise</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isSimpleObject">isSimpleObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~makeSafeForFormInput">makeSafeForFormInput</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysDedupe">mergeArraysDedupe</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysKeepDupes">mergeArraysKeepDupes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objToString">objToString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~regexEscapeStr">regexEscapeStr</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~shallowCopy">shallowCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~stringArrayToNiceString">stringArrayToNiceString</a></li></ul></li><li><a href="module-helpers_jrh_mongo.html">helpers/jrh_mongo</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseResourceUse">calcDatabaseResourceUse</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseStructure">calcDatabaseStructure</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~isValidMongooseObjectId">isValidMongooseObjectId</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~mongoIdEqual">mongoIdEqual</a></li></ul></li><li><a href="module-helpers_jrh_mongo_filter.html">helpers/jrh_mongo_filter</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~buildMongooseQueryFromReq">buildMongooseQueryFromReq</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilter">convertReqQueryStringToAMongooseFindFilter</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterBoolean">convertReqQueryStringToAMongooseFindFilterBoolean</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperator">convertReqQueryStringToAMongooseFindFilterGenericOperator</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal">convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterMongoStrCmp">convertReqQueryStringToAMongooseFindFilterMongoStrCmp</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterNumeric">convertReqQueryStringToAMongooseFindFilterNumeric</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterStringic">convertReqQueryStringToAMongooseFindFilterStringic</a></li></ul></li><li><a href="module-helpers_jrh_text.html">helpers/jrh_text</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_text.html#~jrBootstrapCollapseBox">jrBootstrapCollapseBox</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormInputPassword">jrHtmlFormInputPassword</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionList">jrHtmlFormOptionList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionListSelect">jrHtmlFormOptionListSelect</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlNiceOptionFromList">jrHtmlNiceOptionFromList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlStrigifyObject">jrHtmlStrigifyObject</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralize">jrPluralize</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralizeCount">jrPluralizeCount</a></li></ul></li><li><a href="module-helpers_jrh_validate.html">helpers/jrh_validate</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateInteger">validateInteger</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateIntegerRange">validateIntegerRange</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateRealName">validateRealName</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateString">validateString</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateTrueFalse">validateTrueFalse</a></li></ul></li><li><a href="module-helpers_jrlog.html">helpers/jrlog</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrlog.html#~aliasWinstonLogger">aliasWinstonLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~calcLogFilePath">calcLogFilePath</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createLogFileObj">createLogFileObj</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createWinstonLoggerObject">createWinstonLoggerObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~getWinstonCategoryLogger">getWinstonCategoryLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~log">log</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionError">logExceptionError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionErrorWithMessage">logExceptionErrorWithMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logMessage">logMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logObject">logObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupMorganMiddlewareForExpressWebAccessLogging">setupMorganMiddlewareForExpressWebAccessLogging</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupWinstonLogger">setupWinstonLogger</a></li></ul></li><li><a href="module-helpers_jrresult.html">helpers/jrresult</a></li><li><a href="module-models_app.html">models/app</a></li><li><a href="module-models_connection.html">models/connection</a></li><li><a href="module-models_file.html">models/file</a></li><li><a href="module-models_log.html">models/log</a></li><li><a href="module-models_login.html">models/login</a></li><li><a href="module-models_model_base_mongoose_minimal.html">models/model_base_mongoose_minimal</a></li><li><a href="module-models_modelBaseMongoose.html">models/modelBaseMongoose</a></li><li><a href="module-models_option.html">models/option</a></li><li><a href="module-models_room.html">models/room</a></li><li><a href="module-models_roomdata.html">models/roomdata</a></li><li><a href="module-models_session.html">models/session</a></li><li><a href="module-models_user.html">models/user</a></li><li><a href="module-models_verification.html">models/verification</a></li><li><a href="module-routes_admin.html">routes/admin</a></li><li><a href="module-routes_analytics.html">routes/analytics</a></li><li><a href="module-routes_api.html">routes/api</a><ul class='methods'><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenAccess">makeSecureTokenAccess</a></li><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenAccessFromRefreshToken">makeSecureTokenAccessFromRefreshToken</a></li><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenRefresh">makeSecureTokenRefresh</a></li><li data-type='method'><a href="module-routes_api.html#~routerAllTokentest">routerAllTokentest</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetIndex">routerGetIndex</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetRefreshaccess">routerGetRefreshaccess</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetReqrefresh">routerGetReqrefresh</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetWildcard">routerGetWildcard</a></li><li data-type='method'><a href="module-routes_api.html#~routerPostReqrefresh">routerPostReqrefresh</a></li><li data-type='method'><a href="module-routes_api.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_app.html">routes/app</a></li><li></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_login.html">routes/login</a></li><li><a href="module-routes_logout.html">routes/logout</a></li><li><a href="module-routes_membersonly.html">routes/membersonly</a></li><li><a href="module-routes_profile.html">routes/profile</a></li><li><a href="module-routes_register.html">routes/register</a></li><li><a href="module-routes_room.html">routes/room</a></li><li><a href="module-routes_verify.html">routes/verify</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">helpers/jrh_misc.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module helpers/jrh_misc
 * @author jesse reichler &lt;mouser@donationcoder.com>
 * @copyright 5/7/19

 * @description
 * Collection of general purpose helper functions
*/

"use strict";


// modules
const util = require("util");



//---------------------------------------------------------------------------
// helper function for merging unique arrays
// see https://stackoverflow.com/questions/1584370/how-to-merge-two-arrays-in-javascript-and-de-duplicate-items
/**
 * Combine two arrays and return the concatenation; duplicates are *not* removed
 *
 * @param {array} array1
 * @param {array} array2
 * @returns concatenated array
 */
function mergeArraysKeepDupes(array1, array2) {
	return array1.concat(array2);
}

/**
 * Combine two arrays and return the combined array, removing all duplicates
 *
 * @param {array} array1
 * @param {array} array2
 * @returns the combined de-duped array
 */
function mergeArraysDedupe(array1, array2) {
	return Array.from(new Set(array1.concat(array2)));
}

/**
 * Check if a value is present in any arrays
 *
 * @param {*} val
 * @param {array} arrays (1 or more arrays passed as variadic arguements)
 * @returns true if val is found in any of the arrays
 */
function isInAnyArray(val, ...arrays) {
	for (var ar of arrays) {
		if (ar &amp;&amp; ar.indexOf(val) !== -1) {
			return true;
		}
	}
	return false;
}
//---------------------------------------------------------------------------



//---------------------------------------------------------------------------
/**
 * Take an iteratble (array) of objects and a function to call on each, and do an await function on each.
 * @example asyncAwaitForEachFunctionCall([1 2 3], (x) => {console.log(x)})
 * @see &lt;a href="https://gist.github.com/Atinux/fd2bcce63e44a7d3addddc166ce93fb2">foreach async&lt;/a>
 *
 * @param {array} array
 * @param {function} func
 */
async function asyncAwaitForEachFunctionCall(array, func) {
	for (let index = 0; index &lt; array.length; index++) {
		await func(array[index], index, array);
	}
}
//---------------------------------------------------------------------------



//---------------------------------------------------------------------------
/**
 * If val evaluates to false (which will happen on values of null, undefined, false, and ""), return defaultVal, otherwise return val.
 * ##### Notes
 *  * The intention of this function is to be used to check if a value was provided for some option, and use a default if not.
 *  * This can be confusing if the false value is passed in and caller expects to get it back instead of the defaultVal
 *  * In previous version we explicitly tested val against null, undefined, and ""
 *  * The main reason to use a function for this instead of just using a line in code testing truthiness of val, is to help us locate these kind of tests in code via a search, since they are prone to issues.
 *
 * @param {*} val
 * @param {*} defaultVal
 * @returns val [if it evaluates to true] else defaultVal
 */
function getNonFalseValueOrDefault(val, defaultVal) {
	if (!val) {
		return defaultVal;
	}
	return val;
}


/**
 * If val is not undefined and not null, return it; otherwise return default val.
 * ##### Notes
 *  * The intention of this function is to be used to check if a value was provided for some option, and use a default if not.
 *  * This can be confusing if the false value is passed in and caller expects to get it back instead of the defaultVal
 *  * The main reason to use a function for this instead of just using a line in code testing truthiness of val, is to help us locate these kind of tests in code via a search, since they are prone to issues.
 *
 * @param {*} val
 * @param {*} defaultVal
 * @returns val [if it evaluates to true] else defaultVal
 */
function getNonNullValueOrDefault(val, defaultVal) {
	if (val === undefined || val === null) {
		return defaultVal;
	}
	return val;
}



/**
 * Accepts a variadic list of arguments and returns the first one that can be coerced to true.
 *
 * @param {*} args - variadic list of arguments
 * @returns the first arg that evaluates to true (e.g. not null, undefined, false, ""); if none found returns undefined
 */
function firstCoercedTrueValue(...args) {
	if (!args || args.length === 0) {
		return undefined;
	}
	for (var arg of args) {
		if (arg) {
			return arg;
		}
	}
	// none found
	return undefined;
}



/**
 * Checks if the passed argument is an empty object/array/list by checking its length
 *
 * @param {*} obj - an array, object, or iterable with length property, OR an undefined/null valued variable
 * @returns true if the passed obj evaluates to false (null, undefined, "", false) OR is an object/array with no properties.
 * @see &lt;a href="https://stackoverflow.com/questions/679915/how-do-i-test-for-an-empty-javascript-object">stackoverflow question on testing for empty objects&lt;/a>
 */
function isObjectEmpty(obj) {
	if (!obj || (Object.entries(obj).length === 0 &amp;&amp; obj.constructor === Object)) {
		return true;
	}
	if (!obj || Object.keys(obj).length === 0) {
		return true;
	}
	return false;
}
//---------------------------------------------------------------------------




//---------------------------------------------------------------------------
/**
 * return a new Date() whose date is a certain number of minutes in the future; useful for setting expiration times
 *
 * @param {int} expirationMinutes
 * @returns Date
 */
function DateNowPlusMinutes(expirationMinutes) {
	var expirationDate = new Date();
	expirationDate.setMinutes(expirationDate.getMinutes() + expirationMinutes);
	return expirationDate;
}
//---------------------------------------------------------------------------







//---------------------------------------------------------------------------
/**
 * Copies an objects properties, in a shallow fashion (nested objects/arrays reuse the references)
 * ##### Notes
 *  * This is not a deep copy, it will reuse any sub object/array properties
 *  * We use a function instead of one-line of code to make it easier to find places in code where this happens
 *  * See &lt;a href="https://medium.com/better-programming/3-ways-to-clone-objects-in-javascript-f752d148054d">Medium.com post on different ways to copy objects&lt;/a>
 *
 * @param {object} source
 * @returns new object with cloned properties
 */
function shallowCopy(source) {
	// just a simple wrapper to make code easier to understand
	// var obj = Object.assign({}, source);
	var obj = { ...source };
	return obj;
}



/**
 * Performs a deep copy of an object, recursing into sub properties to clone them instead of reuse references
 * ##### Notes
 * See &lt;a href="https://medium.com/better-programming/3-ways-to-clone-objects-in-javascript-f752d148054d">Medium.com post on different ways to copy objects&lt;/a>
 * @param {*} src
 * @returns new object deep copy of the source
 */
function deepIterationCopy(src) {
	var target = {};
	for (var prop in src) {
		if (Object.prototype.hasOwnProperty.call(src, prop)) {
			if (isSimpleObject(src[prop])) {
				// it's a nested property
				target[prop] = deepIterationCopy(src[prop]);
			} else {
				target[prop] = src[prop];
			}
		}
	}
	return target;
}
//---------------------------------------------------------------------------


//---------------------------------------------------------------------------
/**
 * Simple wrapper arround array.toString that returns blank string if passed value is null, undefined, or empty
 *
 * @param {array} arr - an array or null or undefined
 * @returns arr.toString() if there are items in the array, otherwise empty string ""
 */
function stringArrayToNiceString(arr) {
	if (!arr || arr.length === 0) {
		return "";
	}
	return arr.toString();
}


/**
 * Return current date as a string in a nice format, in local time zone
 * @returns current date as string
 */
function getNiceNowString() {
	return new Date(Date.now()).toLocaleString();
}


/**
 * Return the current date in a standardized string format with precise timing; suitable for timestampign to seconds accuracy
 * @returns current date and time as string with seconds precision
 */
function getPreciseNowString() {
	return new Date(Date.now()).toISOString();
}
//---------------------------------------------------------------------------








//---------------------------------------------------------------------------
/**
 * Replace special characters in string so it can be used in regex.
 * This is useful when we want to use a user-provided string in a regular expression and so we need to validate/escape it first.
 * It is used in our admin crud area filters to convert a simple user substring into a wildcard search string
 * @todo Check this for any security vulnerabilities
 *
 * @param {string} str
 * @returns escaped version of string suitable for use inside a regular expression (i.e. no unescaped regex characters)
 */
function regexEscapeStr(str) {
	str = str.replace(/[-/\\^$*+?.()|[\]{}]/g, "\\$&amp;");
	return str;
}

/**
 * Escape any characters or remove them, that would be illegal to have inside a form input value
 * ##### Notes
 *  * Replaces double quote characters with &amp;quot;
 *
 * @param {string} str
 * @returns version of string with double quotes replaced, etc.
 */
function makeSafeForFormInput(str) {
	return str.replace(/"/g, "&amp;quot;");
}
//---------------------------------------------------------------------------




//---------------------------------------------------------------------------
/**
 * Returns true if the passed value is derived from the Object class/constructor.
 * ##### Notes
 *  * This will return false for object that are more elaborate classes, and is only meant to be used for doing deep copies of simple {} objects
 *  * This will return false if the passed value is null or undefined
 *  * This will return false if the passed object is a function (unlike the code it was based on)
 *  * see &lt;a href="https://stackoverflow.com/questions/8511281/check-if-a-value-is-an-object-in-javascript">stackoverflow on checking if a value is an object&lt;/a>
 *
 * @param {*} maybeObj
 * @returns true if the passed value is a (simple) object
 */
function isSimpleObject(maybeObj) {
	// return (maybeObj !== undefined &amp;&amp; maybeObj !== null &amp;&amp; maybeObj.constructor === Object);
	var type = typeof maybeObj;
	return type === "object" &amp;&amp; !!maybeObj;
}


/**
 * Returns true if the object passed is a promise
 * @see &lt;a href="https://stackoverflow.com/questions/27746304/how-do-i-tell-if-an-object-is-a-promise">stackoverflow post&lt;/a>
 *
 * @param {*} value
 * @returns true if the passed value is a promise
 */
function isPromise(value) {
	return Boolean(value &amp;&amp; typeof value.then === "function");
}
//---------------------------------------------------------------------------




//---------------------------------------------------------------------------
/**
 * Simple wrapper around JSON.parse, which parses a json string and creates an object.
 * Only thing extra we do is check for being passed in an empty string/null/undefined and return {} in that case
 *
 * @param {string} str
 * @param {*} defaultVal
 * @returns result of JSON.parse on string or {} if string is "" or undefined or null
 */
function createObjectFromJsonParse(str, defaultVal) {
	if (!str) {
		return defaultVal;
	}
	var parsedObj = JSON.parse(str);
	return parsedObj;
}
//---------------------------------------------------------------------------



//---------------------------------------------------------------------------
/**
 * Try to figure out the servers ip address, and return it as a string.
 * ##### Notes
 *  * see &lt;a href="https://stackoverflow.com/questions/3653065/get-local-ip-address-in-node-js">stackoverflow post&lt;/a>
 *  * This function has barely been tested and should not be considered reliable.
 *  * We are currently using it only to get a string that we can use to look for a site-specific configuration file based on the current server ip, and just to display on screen and in logs.
 *  * So our goal is simply to return a string that is different on different servers, but always the same on a given server
 *  * You cannot assume that the returned value is of a particular format; we dont check for that.
 * @returns string representation of ip address
 */
function getServerIpAddress() {
	var os = require("os");

	var ifaces = os.networkInterfaces();
	var ifacesKeys = Object.keys(ifaces);
	var iface, ifname, ifaceset;
	var bestip;
	var alias = 0;

	// jrdebug.debugObj(ifaces, "ifaces");
	// jrdebug.debugObj(ifacesKeys, "ifacesKeys");

	for (var j = 0; j &lt; ifacesKeys.length; ++j) {
		ifname = ifacesKeys[j];

		ifaceset = ifaces[ifname];
		// jrdebug.debugObj(ifaceset, "ifaceset");

		alias = 0;
		for (var i = 0; i &lt; ifaceset.length; ++i) {
			iface = ifaceset[i];
			// jrdebug.debugObj(iface, "iface[" + ifname + "]");
			if (iface.family !== "IPv4" || iface.internal !== false) {
				// skip over internal (i.e. 127.0.0.1) and non-ipv4 addresses
				bestip = iface.address;
			} else if (alias >= 1) {
				// this single interface has multiple ipv4 addresses
				bestip = iface.address;
				break;
			} else {
				// this interface has only one ipv4 adress
				bestip = iface.address;
				break;
			}
			++alias;
		}
		if (bestip) {
			return bestip;
		}
	}
	// not found;
	return "";
}
//---------------------------------------------------------------------------



//---------------------------------------------------------------------------
/**
 * Find the longest string in haystack which matches a prefix of longstr (with separatorStr or empty)
 * Then return a tuple [longeststring, remainder] with separatorStr removed from longeststring and remainder
 *
 * @param {string} longstr
 * @param {array} haystack
 * @param {string} separatorStr
 */
function findLongestPrefixAndRemainder(longstr, haystack, separatorStr) {
	var longestLen = 0;
	var longestStr = "";
	const separatorStrLength = separatorStr.length;
	const longstrLength = longstr.length;
	var candidateLength;
	var candidate;
	// walk array of strings
	for (var i = 0; i &lt; haystack.length; ++i) {
		candidate = haystack[i];
		candidateLength = candidate.length;
		if (candidateLength > longstrLength) {
			// cannot match, too long
			continue;
		}
		if (candidate === longstr) {
			// found exact match, we can stop now
			return [candidate, ""];
		}
		if (candidateLength + separatorStrLength &lt; longstrLength &amp;&amp; candidateLength > longestLen) {
			// check if its an initial substring
			if (longstr.substr(0, candidateLength + separatorStrLength) === candidate + separatorStr) {
				// ok we have a match with candidate + separate on left hand side
				// our new longest candidate
				longestStr = candidate;
				longestLen = candidateLength;
			}
		}
	}
	// did we find a good match?
	if (longestLen === 0) {
		// nothing found
		return ["", longstr];
	}
	// we found something
	const remainderStr = longstr.substr(candidateLength + separatorStrLength);
	return [longestStr, remainderStr];
}
//---------------------------------------------------------------------------





//---------------------------------------------------------------------------
/**
 * Stringify an object nicely for display on console
 * ##### Notes
 *  * See &lt;a href="https://stackoverflow.com/questions/10729276/how-can-i-get-the-full-object-in-node-jss-console-log-rather-than-object">stackoverflow&lt;/a>
 *  * See &lt;a href="https://nodejs.org/api/util.html#util_util_inspect_object_options">nodejs docs&lt;/a>
 *
 * @param {*} obj - the object to stringify
 * @param {*} flagCompact - if true then we use a compact single line output format
 * @returns string suitable for debug/diagnostic display
 */
function objToString(obj, flagCompact) {
	// return util.inspect(obj, false, null, true /* enable colors */);
	var options = {};
	if (flagCompact) {
		options = {
			showHidden: false,
			depth: 2,
			colors: false,
			compact: true,
			breakLength: Infinity,
		};
	} else {
		options = {
			showHidden: false,
			depth: 2,
			colors: false,
			compact: false,
			breakLength: 80,
		};
	}
	return util.inspect(obj, options);
}
//---------------------------------------------------------------------------








module.exports = {
	mergeArraysKeepDupes,
	mergeArraysDedupe,
	isInAnyArray,

	asyncAwaitForEachFunctionCall,

	getNonFalseValueOrDefault,
	getNonNullValueOrDefault,
	firstCoercedTrueValue,
	isObjectEmpty,

	DateNowPlusMinutes,

	shallowCopy,
	deepIterationCopy,

	stringArrayToNiceString,
	getNiceNowString,
	getPreciseNowString,

	regexEscapeStr,
	makeSafeForFormInput,

	isSimpleObject,
	isPromise,
	createObjectFromJsonParse,

	getServerIpAddress,

	findLongestPrefixAndRemainder,

	objToString,
};
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.3</a> on Wed Nov 20 2019 08:03:05 GMT-0600 (Central Standard Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
