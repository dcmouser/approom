<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>client/arclient.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JrResult.JrResult.html">JrResult</a></li><li><a href="module-client_arclient-AppRoomClient.html">AppRoomClient</a></li><li><a href="module-controllers_aclaid-AclAid.html">AclAid</a></li><li><a href="module-controllers_adminaid-AdminAid.html">AdminAid</a></li><li><a href="module-controllers_arserver-AppRoomServer.html">AppRoomServer</a><ul class='methods'><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#emergencyAlert">emergencyAlert</a></li></ul></li><li><a href="module-controllers_crudaid-CrudAid.html">CrudAid</a></li><li><a href="module-controllers_ratelimiteraid-RateLimiterAid.html">RateLimiterAid</a></li><li><a href="module-controllers_registrationaid-RegistrationAid.html">RegistrationAid</a></li><li><a href="module-controllers_sendaid-SendAid.html">SendAid</a><ul class='methods'><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMail">sendMail</a></li><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMessage">sendMessage</a></li></ul></li><li><a href="module-helpers_jrresult-JrResult.html">JrResult</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#._unusedCodeExpressMiddlewareInjectSessionResult">_unusedCodeExpressMiddlewareInjectSessionResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.getMergeSessionResultAndClear">getMergeSessionResultAndClear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isJrResult">isJrResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeAndRemoveFromSession">makeAndRemoveFromSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeClone">makeClone</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeError">makeError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeMessage">makeMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeNew">makeNew</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeSuccess">makeSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.passportOrJrResultErrorAsString">passportOrJrResultErrorAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.undefinedIfBlank">undefinedIfBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#addToSession">addToSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clear">clear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clearSection">clearSection</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getDoneRendering">getDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getErrorsAsString">getErrorsAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getExtraData">getExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getFieldError">getFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getSuccessAsString">getSuccessAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getType">getType</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#isError">isError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#mergeIn">mergeIn</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#push">push</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushBiFieldError">pushBiFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushError">pushError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushErrorOnTop">pushErrorOnTop</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushException">pushException</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushFieldError">pushFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushMessage">pushMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushSuccess">pushSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setDoneRendering">setDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setError">setError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setExtraData">setExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setFieldError">setFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setType">setType</a></li></ul></li><li><a href="module-models_app-AppModel.html">AppModel</a></li><li><a href="module-models_connection-ConnectionModel.html">ConnectionModel</a></li><li><a href="module-models_file-FileModel.html">FileModel</a></li><li><a href="module-models_login-LoginModel.html">LoginModel</a></li><li><a href="module-models_log-LogModel.html">LogModel</a></li><li><a href="module-models_model_base_mongoose_minimal-ModelBaseMongooseMinimal.html">ModelBaseMongooseMinimal</a></li><li><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html">ModelBaseMongoose</a><ul class='methods'><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#.doChangeModeById">doChangeModeById</a></li><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#doChangeMode">doChangeMode</a></li></ul></li><li><a href="module-models_modqueue-ModQueueModel.html">ModQueueModel</a></li><li><a href="module-models_option-OptionModel.html">OptionModel</a></li><li><a href="module-models_roomdata-RoomdataModel.html">RoomdataModel</a></li><li><a href="module-models_room-RoomModel.html">RoomModel</a></li><li><a href="module-models_session-SessionModel.html">SessionModel</a></li><li><a href="module-models_subscription-SubscriptionModel.html">SubscriptionModel</a></li><li><a href="module-models_user-UserModel.html">UserModel</a><ul class='methods'><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermission">aclHasPermission</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionOnAll">aclHasPermissionOnAll</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionSeeVDeletes">aclHasPermissionSeeVDeletes</a></li></ul></li><li><a href="module-models_verification-VerificationModel.html">VerificationModel</a></li></ul><h3>Modules</h3><ul><li><a href="module-approomglobals.html">approomglobals</a><ul class='methods'><li data-type='method'><a href="module-approomglobals.html#~setOverrideOptions">setOverrideOptions</a></li><li data-type='method'><a href="module-approomglobals.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-client_arclient.html">client/arclient</a></li><li><a href="module-clientTests.html">clientTests</a></li><li><a href="module-controllers_aclaid.html">controllers/aclaid</a></li><li><a href="module-controllers_adminaid.html">controllers/adminaid</a></li><li><a href="module-controllers_appconst.html">controllers/appconst</a></li><li><a href="module-controllers_arserver.html">controllers/arserver</a></li><li><a href="module-controllers_crudaid.html">controllers/crudaid</a></li><li><a href="module-controllers_jrequireaid.html">controllers/jrequireaid</a><ul class='methods'><li data-type='method'><a href="module-controllers_jrequireaid.html#~setDeferredLoading">setDeferredLoading</a></li><li data-type='method'><a href="module-controllers_jrequireaid.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-controllers_ratelimiteraid.html">controllers/ratelimiteraid</a></li><li><a href="module-controllers_registrationaid.html">controllers/registrationaid</a></li><li><a href="module-controllers_sendaid.html">controllers/sendaid</a></li><li><a href="module-helpers_jrconfig.html">helpers/jrconfig</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrconfig.html#~addConfigFile">addConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~doNconfFile">doNconfFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~findQueuedCommand">findQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~fixConfigFilePathName">fixConfigFilePathName</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugFiles">getDebugFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugHierarchy">getDebugHierarchy</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugOptions">getDebugOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getVal">getVal</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getValDefault">getValDefault</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~ipStringToSafeFilenameString">ipStringToSafeFilenameString</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeCliConfigFiles">nconfMergeCliConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeConfigFile">nconfMergeConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~parse">parse</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~popQueuedCommand">popQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~queueYargsCommand">queueYargsCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~runQueuedCommands">runQueuedCommands</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setConfigDirAndDiscoverConfigFiles">setConfigDirAndDiscoverConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setDefaultOptions">setDefaultOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setEnvList">setEnvList</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setOverrideOptions">setOverrideOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setServerFilenamePrefixFromServerIp">setServerFilenamePrefixFromServerIp</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setYargs">setYargs</a></li></ul></li><li><a href="module-helpers_jrdebug.html">helpers/jrdebug</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebug">cdebug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugf">cdebugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugObj">cdebugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debug">debug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugf">debugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugObj">debugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~getDebugEnabled">getDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setDebugEnabled">setDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setupDebugmod">setupDebugmod</a></li></ul></li><li><a href="module-helpers_jrequire.html">helpers/jrequire</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrequire.html#~calcDebugInfo">calcDebugInfo</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~calcPluginRegisteredName">calcPluginRegisteredName</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~fixRequirePath">fixRequirePath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~getAllPlugins">getAllPlugins</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~getPluginsForCategory">getPluginsForCategory</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~jrequire">jrequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~plugin">plugin</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerPath">registerPath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerPlugin">registerPlugin</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerRequire">registerRequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~setDeferredLoading">setDeferredLoading</a></li></ul></li><li><a href="module-helpers_jrh_axios.html">helpers/jrh_axios</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_axios.html#~calcAxiosOptions">calcAxiosOptions</a></li><li data-type='method'><a href="module-helpers_jrh_axios.html#~getCatchError">getCatchError</a></li><li data-type='method'><a href="module-helpers_jrh_axios.html#~postCatchError">postCatchError</a></li></ul></li><li><a href="module-helpers_jrh_crypto.html">helpers/jrh_crypto</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_crypto.html#~createHashedObjectFromString">createHashedObjectFromString</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~generateRandomSalt">generateRandomSalt</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringFromCharSet">genRandomStringFromCharSet</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHex">genRandomStringHex</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasier">genRandomStringHumanEasier</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasy">genRandomStringHumanEasy</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextPasswordToObj">hashPlaintextPasswordToObj</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextStringInsecureButSearchable">hashPlaintextStringInsecureButSearchable</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~testPlaintextPassword">testPlaintextPassword</a></li></ul></li><li><a href="module-helpers_jrh_express.html">helpers/jrh_express</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordAuthenticate">asyncPasswordAuthenticate</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordReqLogin">asyncPasswordReqLogin</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddleWare">calcExpressMiddleWare</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareGetFileLine">calcExpressMiddlewareGetFileLine</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareRouterHint">calcExpressMiddlewareRouterHint</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathData">calcExpressRoutePathData</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataRouteArray">calcExpressRoutePathDataRouteArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataSplit">calcExpressRoutePathDataSplit</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~forgetSessionVar">forgetSessionVar</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~normalizePort">normalizePort</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~parseReqGetJsonField">parseReqGetJsonField</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqOriginalUrl">reqOriginalUrl</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedCheckboxItemIds">reqPrefixedCheckboxItemIds</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedValueArray">reqPrefixedValueArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqUrlWithPath">reqUrlWithPath</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqVal">reqVal</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValAsInt">reqValAsInt</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValFromList">reqValFromList</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendResJsonAclErorr">sendResJsonAclErorr</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendResJsonData">sendResJsonData</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendResJsonError">sendResJsonError</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendResJsonJrResult">sendResJsonJrResult</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~sendResJsonJrResultTokenError">sendResJsonJrResultTokenError</a></li></ul></li><li><a href="module-helpers_jrh_grid.html">helpers/jrh_grid</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_grid.html#~calcHeaderKeysNicely">calcHeaderKeysNicely</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridList">jrGridList</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListBulkActions">jrGridListBulkActions</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPager">jrGridListPager</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItem">jrGridListPagerItem</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItemPerPage">jrGridListPagerItemPerPage</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListShowHiddenOptions">jrGridListShowHiddenOptions</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTable">jrGridListTable</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableData">jrGridListTableData</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeader">jrGridListTableHeader</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeaderSortDir">jrGridListTableHeaderSortDir</a></li></ul></li><li><a href="module-helpers_jrh_handlebars.html">helpers/jrh_handlebars</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~loadPartialFiles">loadPartialFiles</a></li><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~setupJrHandlebarHelpers">setupJrHandlebarHelpers</a></li></ul></li><li><a href="module-helpers_jrh_misc.html">helpers/jrh_misc</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncAwaitForEachFunctionCall">asyncAwaitForEachFunctionCall</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncNextTick">asyncNextTick</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~createObjectFromJsonParse">createObjectFromJsonParse</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~DateNowPlusMinutes">DateNowPlusMinutes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~deepIterationCopy">deepIterationCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~ErrorToHashableMapObject">ErrorToHashableMapObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~findLongestPrefixAndRemainder">findLongestPrefixAndRemainder</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~firstCoercedTrueValue">firstCoercedTrueValue</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getCompactNowString">getCompactNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDateValString">getNiceDateValString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDurationTimeMs">getNiceDurationTimeMs</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceNowString">getNiceNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonFalseValueOrDefault">getNonFalseValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueFromObject">getNonNullValueFromObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueOrDefault">getNonNullValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getPreciseNowString">getPreciseNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getServerIpAddress">getServerIpAddress</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isInAnyArray">isInAnyArray</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectEmpty">isObjectEmpty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectHashMappableType">isObjectHashMappableType</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isPromise">isPromise</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isSimpleObject">isSimpleObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~makeSafeForFormInput">makeSafeForFormInput</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysDedupe">mergeArraysDedupe</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysKeepDupes">mergeArraysKeepDupes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objectHasProperty">objectHasProperty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objToString">objToString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~regexEscapeStr">regexEscapeStr</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~shallowCopy">shallowCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~stringArrayToNiceString">stringArrayToNiceString</a></li></ul></li><li><a href="module-helpers_jrh_mongo.html">helpers/jrh_mongo</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseResourceUse">calcDatabaseResourceUse</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseStructure">calcDatabaseStructure</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~convertArrayOfObjectIdsToIdArray">convertArrayOfObjectIdsToIdArray</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~isValidMongooseObjectId">isValidMongooseObjectId</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~mongoIdEqual">mongoIdEqual</a></li></ul></li><li><a href="module-helpers_jrh_mongo_filter.html">helpers/jrh_mongo_filter</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~buildMongooseQueryFromReq">buildMongooseQueryFromReq</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilter">convertReqQueryStringToAMongooseFindFilter</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterBoolean">convertReqQueryStringToAMongooseFindFilterBoolean</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperator">convertReqQueryStringToAMongooseFindFilterGenericOperator</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal">convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterMongoStrCmp">convertReqQueryStringToAMongooseFindFilterMongoStrCmp</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterNumeric">convertReqQueryStringToAMongooseFindFilterNumeric</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterStringic">convertReqQueryStringToAMongooseFindFilterStringic</a></li></ul></li><li><a href="module-helpers_jrh_text.html">helpers/jrh_text</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_text.html#~capitalizeFirstLetter">capitalizeFirstLetter</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~formatChoiceValueForGridDisplay">formatChoiceValueForGridDisplay</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrBootstrapCollapseBox">jrBootstrapCollapseBox</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormInputPassword">jrHtmlFormInputPassword</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionList">jrHtmlFormOptionList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionListSelect">jrHtmlFormOptionListSelect</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlNiceOptionFromList">jrHtmlNiceOptionFromList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlStrigifyObject">jrHtmlStrigifyObject</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralize">jrPluralize</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralizeCount">jrPluralizeCount</a></li></ul></li><li><a href="module-helpers_jrh_validate.html">helpers/jrh_validate</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateInteger">validateInteger</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateIntegerRange">validateIntegerRange</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateJsonObjOrStringToObj">validateJsonObjOrStringToObj</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateRealName">validateRealName</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateString">validateString</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateTrueFalse">validateTrueFalse</a></li></ul></li><li><a href="module-helpers_jrlog.html">helpers/jrlog</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrlog.html#~aliasWinstonLogger">aliasWinstonLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~calcLogFilePath">calcLogFilePath</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createLogFileObj">createLogFileObj</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createWinstonLoggerObject">createWinstonLoggerObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~getWinstonCategoryLogger">getWinstonCategoryLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~log">log</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logDefaultError">logDefaultError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionError">logExceptionError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionErrorWithMessage">logExceptionErrorWithMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logMessage">logMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logObject">logObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupMorganMiddlewareForExpressWebAccessLogging">setupMorganMiddlewareForExpressWebAccessLogging</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupWinstonLogger">setupWinstonLogger</a></li></ul></li><li><a href="module-helpers_jrresult.html">helpers/jrresult</a></li><li><a href="module-models_app.html">models/app</a></li><li><a href="module-models_connection.html">models/connection</a></li><li><a href="module-models_file.html">models/file</a></li><li><a href="module-models_log.html">models/log</a></li><li><a href="module-models_login.html">models/login</a></li><li><a href="module-models_model_base_mongoose_minimal.html">models/model_base_mongoose_minimal</a></li><li><a href="module-models_modelBaseMongoose.html">models/modelBaseMongoose</a></li><li><a href="module-models_modqueue.html">models/modqueue</a></li><li><a href="module-models_option.html">models/option</a></li><li><a href="module-models_room.html">models/room</a></li><li><a href="module-models_roomdata.html">models/roomdata</a></li><li><a href="module-models_session.html">models/session</a></li><li><a href="module-models_subscription.html">models/subscription</a></li><li><a href="module-models_user.html">models/user</a></li><li><a href="module-models_verification.html">models/verification</a></li><li><a href="module-plugins_testplugin.html">plugins/testplugin</a></li><li><a href="module-routes_admin.html">routes/admin</a></li><li></li><li></li><li><a href="module-routes_analytics.html">routes/analytics</a></li><li><a href="module-routes_api_api.html">routes/api/api</a><ul class='methods'><li data-type='method'><a href="module-routes_api_api.html#~makeSecureTokenAccess">makeSecureTokenAccess</a></li><li data-type='method'><a href="module-routes_api_api.html#~makeSecureTokenAccessFromRefreshToken">makeSecureTokenAccessFromRefreshToken</a></li><li data-type='method'><a href="module-routes_api_api.html#~makeSecureTokenRefresh">makeSecureTokenRefresh</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllRefreshaccess">routerAllRefreshaccess</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerAllTokentest">routerAllTokentest</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerGetDos">routerGetDos</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerGetIndex">routerGetIndex</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerGetReqrefresh">routerGetReqrefresh</a></li><li data-type='method'><a href="module-routes_api_api.html#~routerPostReqrefresh">routerPostReqrefresh</a></li><li data-type='method'><a href="module-routes_api_api.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_api_app.html">routes/api/app</a><ul class='methods'><li data-type='method'><a href="module-routes_api_app.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_api_roomdata.html">routes/api/roomdata</a><ul class='methods'><li data-type='method'><a href="module-routes_api_roomdata.html#~setupRouter">setupRouter</a></li><li data-type='method'><a href="module-routes_api_roomdata.html#~setupRouter">setupRouter</a></li></ul></li><li></li><li><a href="module-routes_app.html">routes/app</a></li><li></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_login.html">routes/login</a></li><li><a href="module-routes_logout.html">routes/logout</a></li><li><a href="module-routes_membersonly.html">routes/membersonly</a></li><li><a href="module-routes_profile.html">routes/profile</a></li><li><a href="module-routes_register.html">routes/register</a></li><li><a href="module-routes_room.html">routes/room</a></li><li><a href="module-routes_verify.html">routes/verify</a></li><li><a href="module-serverTests.html">serverTests</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">client/arclient.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module client/arclient
 * @author jesse reichler &lt;mouser@donationcoder.com>
 * @copyright 4/14/20
 * @description
 * This module defines a sample js client that can be used to connect to the approom service
 */

"use strict";



// helper modules
const jrhAxios = require("../helpers/jrh_axios");
const jrhMisc = require("../helpers/jrh_misc");



/**
 * Class implementing a sample client that can connect to a running AppRoomServer
 *
 * @class AppRoomClient
 */
class AppRoomClient {


	//---------------------------------------------------------------------------
	// constructor
	constructor() {
		this.status = {
			lastError: "",
			success: true,
			validApiAccess: false,
		};
		//
		this.options = {
			serverUrlBase: null,
			getCredentialsFunction: null,
			errorFunction: null,
			debugFunction: null,
		};
		//
		this.cache = {
			refreshToken: null,
			accessToken: null,
		};

		//
		this.pathRefreshTokenRequest = "/api/reqrefresh";
		this.pathAccessTokenRequest = "/api/refreshaccess";
		this.pathTokenValidate = "/api/tokentest";
	}



	/**
	 * Options are:
	 *  serverUrlBase - the base url for the server (with no path info)
	 *  refreshToken - refresh token (generated previously or this session)
	 *  accessToken - access token (generated previously or this sesssion)
	 *  getCredentialsFunction - async function that will be called if library needs a username/password to login
	 *  errorFunction - async function that will be called on all errors
	 *  debugFunction - async function called with a debug message
 	 *
 	 * @param {*} val
 	 * @memberof AppRoomClient
 	 */
	setOptions(val) {
		this.options = val;
	}


	/**
	 * Set one option
 	 * @param string key
 	 * @param {*} val
 	 * @memberof AppRoomClient
 	 */
	setOption(key, val) {
		this.options[key] = val;
	}
	//---------------------------------------------------------------------------



	//---------------------------------------------------------------------------
	getOptionServerUrlBase() {
		return this.options.serverUrlBase;
	}
	//---------------------------------------------------------------------------


	//---------------------------------------------------------------------------
	/**
	 * Returns the status of the connection, an object with the following values:
	 *  lastError - string with the last error from the last call
	 *  success - true if last api call was a success
	 *  validApiAccess - true if we successfully gotten an api access key that works
	 *
	 * @memberof AppRoomClient
	 */
	getStatus() {
		return this.status;
	}

	getStatusSuccess() {
		return this.status.success;
	}

	setStatusSuccess(val) {
		this.status.success = val;
	}

	setValidApiAccess(val) {
		this.status.validApiAccess = val;
	}

	getValidApiAccess() {
		return this.status.validApiAccess;
	}

	getLastError() {
		return this.status.lastError;
	}

	getAccessToken() {
		return this.cache.accessToken;
	}

	setAccessToken(val) {
		this.cache.accessToken = val;
	}
	//---------------------------------------------------------------------------


	//---------------------------------------------------------------------------
	/**
	 * This is the main async function that tried to connect to the server prior to being usable
	 * Note that this function will attempt to us an existing long-living access token,
	 * or if that expires, fall back on requesting a new access token if it has a stored refresh token
	 * or failing that, it may prompt user to log in to get a new refresh token, etc.
	 *
	 * @memberof AppRoomClient
	 */
	async connect(flagReconnect) {

		// clear any prior errors
		this.clearErrors();
		// reset connected state
		this.setValidApiAccess(false);
		//
		var hintMessage = "Your credentials are required in order to retrieve an API refresh key";

		// ok now, we may have some information for the connection already stored (refreshToken, etc.)

		if (this.getAccessToken() &amp;&amp; !flagReconnect) {
			// we already have an access token -- we just need to see if its stil VALID
			await this.validateAccessToken();
			if (this.getStatusSuccess()) {
				// all good
				this.setValidApiAccess(true);
				return;
			}
			// access token is bad (expired, revoked, etc.)
			// drop down and try to get a new one
		}

		if (this.cache.refreshToken) {
			// we have a refresh token, now we need to try to use it to get an access token (which is either expired or bad or missing)
			await this.retrieveAccessTokenFromRefreshToken();
			if (this.getStatusSuccess()) {
				// all good
				this.setValidApiAccess(true);
				return;
			}
			// add to hint message for when we ask for username/pass
			hintMessage += "(" + this.status.lastError + ")";
			// refresh token is bad (expired, revoked, etc.)
			// drop down and try to get a new one
		}

		// we need a new refresh token
		await this.retrieveRefreshTokenUsingCredentials(hintMessage);
		if (!this.getStatusSuccess()) {
			// error, return
			return;
		}

		// we have a NEW refresh token, now we need to get access token from it
		await this.retrieveAccessTokenFromRefreshToken();
		if (this.getStatusSuccess()) {
			// success!
			this.setValidApiAccess(true);
		}
	}
	//---------------------------------------------------------------------------











	//---------------------------------------------------------------------------
	/**
	 * Extra the data field from the response.
	 * Set this.status.success and data.error, which we check for in a variety of ways.  We expect all api calls should have a success = true in the reply, but we might also check for presence of a key-value pair
	 *
	 * @param {*} response - the object returned from a post/get
	 * @param {*} url - url string that fetched the data, for debugging purposes only
	 * @param {*} hintActionString - for debugging purposes
	 * @param {*} expectedKey - if this key is not in the response data then the response is an error
	 * @returns response.data
	 * @memberof AppRoomClient
	 */
	async extractDataTriggerError(response, url, hintActionString, expectedKey) {

		// get data from response
		var data = response.data;

		// debug message
		await this.triggerDebugMessageWithData("Performed " + hintActionString + " on " + url + ", with result: ", data);

		// check for success, and trigger error if error
		if (data.success &amp;&amp; (!expectedKey || expectedKey === "" || data[expectedKey] !== undefined)) {
			// set success true
			this.setStatusSuccess(true);
		} else {
			// set success false
			this.setStatusSuccess(false);
			// make sure it has an error and trigger it
			if (!data.error) {
				if (expectedKey &amp;&amp; expectedKey !== "" &amp;&amp; data[expectedKey] === undefined) {
					data.error = "unexpected reply; missing key value in reply [" + expectedKey + "]";
				} else {
					data.error = "unexpected reply";
				}
			}
			this.triggerError("Error reply during " + hintActionString + " at " + url + ": " + data.error);
		}

		// return data
		return data;
	}
	//---------------------------------------------------------------------------











	//---------------------------------------------------------------------------
	/**
	 * We have an access token, ask server if its still valid
	 * NOTE: this actually will return true even if its a REFRESH token not an access token
	 *
	 * @memberof AppRoomClient
	 */
	async validateAccessToken() {
		// post data
		var url = this.getOptionServerUrlBase() + this.pathTokenValidate;
		var postData = {
			token: this.getAccessToken(),
		};
		var response = await jrhAxios.postCatchError(url, postData);

		// extract data, check for error, set succsss status, last error, etc.
		var data = await this.extractDataTriggerError(response, url, "validateAccessToken", "");
	}




	/**
	 * We have a refresh token, now try to get an access token from it (we may be told its a bad/expired refresh token)
	 *
	 * @memberof AppRoomClient
	 */
	async retrieveAccessTokenFromRefreshToken() {
		// post data
		var url = this.getOptionServerUrlBase() + this.pathAccessTokenRequest;
		var postData = {
			token: this.cache.refreshToken,
		};
		var responseData = await jrhAxios.postCatchError(url, postData);

		// extract data, check for error, set succsss status, last error, etc.
		var data = await this.extractDataTriggerError(responseData, url, "retrieveAccessTokenFromRefreshToken", "token");
		if (!data.error) {
			this.setAccessToken(data.token);
		}
	}


	/**
	 * We need a new refresh token.
	 * This will require logging into the server, possibly asking user for username and password or sending them to the website
	 *
	 * @memberof AppRoomClient
	 */
	async retrieveRefreshTokenUsingCredentials(hintMessage) {
		// get login credentials
		var credentials = await this.triggerRequestCredentials(hintMessage);
		if (!credentials.usernameEmail || !credentials.password) {
			this.triggerError("Credentials missing; aborting request for refresh token.");
			this.setStatusSuccess(false);
		}

		// post data
		var url = this.getOptionServerUrlBase() + this.pathRefreshTokenRequest;
		var postData = {
			usernameEmail: credentials.usernameEmail,
			password: credentials.password,
		};
		var responseData = await jrhAxios.postCatchError(url, postData);

		// extract data, check for error, set succsss status, last error, etc.
		var data = await this.extractDataTriggerError(responseData, url, "retrieveRefreshTokenUsingCredentials", "token");
		if (!data.error) {
			this.cache.refreshToken = data.token;
		}
	}
	//---------------------------------------------------------------------------
































	//---------------------------------------------------------------------------
	async joinRoom(appId, roomId) {

	}


	async createRoom(appId, roomOptions) {

	}


	async uploadDataToRoom(roomId, data) {

	}


	async downloadDataFromRoom(roomId, filter) {

	}
	//---------------------------------------------------------------------------























	//---------------------------------------------------------------------------
	debugToConsole() {
		console.log("Debugging arclient object.");
		console.log("Options:");
		console.log(this.options);
		console.log("Cache:");
		console.log(this.cache);
		console.log("Status:");
		console.log(this.status);
	}
	//---------------------------------------------------------------------------


	//---------------------------------------------------------------------------
	async triggerError(errorMessage) {
		// call error callback function if one is registered
		this.setStatusSuccess(false);
		this.status.lastError = errorMessage;
		if (this.options.errorFunction) {
			await this.options.errorFunction(this, errorMessage);
		}
	}


	async triggerRequestCredentials(hintMessage) {
		// call error callback function if one is registered
		if (this.options.getCredentialsFunction) {
			var credentials = await this.options.getCredentialsFunction(this, hintMessage);
			return credentials;
		}
		// no credentials available
		return {};
	}

	async triggerDebugMessage(debugMessage) {
		if (this.options.debugFunction) {
			await this.options.debugFunction(this, debugMessage);
		}
	}


	async triggerDebugMessageWithData(debugMessage, data) {
		if (this.options.debugFunction) {
			if (data &amp;&amp; data.toString) {
				await this.options.debugFunction(this, debugMessage + ": " + jrhMisc.objToString(data, true));
			} else {
				await this.options.debugFunction(this, debugMessage);
			}
		}
	}
	//---------------------------------------------------------------------------



	//---------------------------------------------------------------------------
	clearErrors() {
		this.success = true;
		this.lastError = "";
	}

	isError() {
		return (this.success === true);
	}
	//---------------------------------------------------------------------------



	//---------------------------------------------------------------------------
	shutDown() {
		// shutdown client
		this.status.validApiAccess = false;
	}
	//---------------------------------------------------------------------------









	//---------------------------------------------------------------------------
	/**
	 * Post a request to an api endpoint return the json result
	 * On error the error field of data will be non-empty
	 *
	 * @param {*} urlEndpoint - url string relative path to base
	 * @param {*} query - json object containing query to be passed in post variable "query"
	 * @returns = json object with repl data
	 * @memberof AppRoomClient
	 */
	async invoke(urlEndpoint, query) {

		// url to hit
		var url = this.getOptionServerUrlBase() + urlEndpoint;

		// data to post (we will add token later)
		var postData = {
			query,
		};

		// now a small loop to post the data and get a reply; we loop so that if we get an error about an invalid/expired access token, we can auto request a new one
		var responseData;
		var data;
		var tryCount = 0;
		while (tryCount &lt; 2) {
			tryCount += 1;
			// if not connected (which may be case after our first fail or initially), lets try to connect
			if (!this.getValidApiAccess()) {
				// try to reconnect and then try again
				await this.connect(true);
				if (!this.getValidApiAccess() &amp;&amp; data) {
					// no point trying to query again since we didnt get valid access and we already failed a call prior
					// so just drop out with the prior failed call
					break;
				}
				// drop down and send request
			}

			// set token (which may be newly gotten from our connect attempt above
			postData.token = this.getAccessToken();

			// post and get response
			responseData = await jrhAxios.postCatchError(url, postData);
			// extract data, check for error, set succsss status, last error, etc.
			data = await this.extractDataTriggerError(responseData, url, "invoking", "");

			// IFF we get a token error reply, we might have an expired access token that we need to renew
			if (!data.tokenError) {
				break;
			}
			// clear valid api access flag and re-loop
			this.setValidApiAccess(false);
		}

		return data;
	}
	//---------------------------------------------------------------------------




}



















//---------------------------------------------------------------------------
function makeNewAppRoomClient() {
	return new AppRoomClient();
}
//---------------------------------------------------------------------------




//---------------------------------------------------------------------------
// export function to create a new instance of class
module.exports = {
	makeNewAppRoomClient,
};
//---------------------------------------------------------------------------
</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Mon Apr 20 2020 04:36:27 GMT-0500 (Central Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
