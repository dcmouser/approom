<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>helpers/jrconfig.js - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="JrResult.JrResult.html">JrResult</a></li><li><a href="module-controllers_aclaid-AclAid.html">AclAid</a></li><li><a href="module-controllers_adminaid-AdminAid.html">AdminAid</a></li><li><a href="module-controllers_arserver-AppRoomServer.html">AppRoomServer</a><ul class='methods'><li data-type='method'><a href="module-controllers_arserver-AppRoomServer.html#emergencyAlert">emergencyAlert</a></li></ul></li><li><a href="module-controllers_crudaid-CrudAid.html">CrudAid</a></li><li><a href="module-controllers_ratelimiteraid-RateLimiterAid.html">RateLimiterAid</a></li><li><a href="module-controllers_registrationaid-RegistrationAid.html">RegistrationAid</a></li><li><a href="module-controllers_sendaid-SendAid.html">SendAid</a><ul class='methods'><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMail">sendMail</a></li><li data-type='method'><a href="module-controllers_sendaid-SendAid.html#sendMessage">sendMessage</a></li></ul></li><li><a href="module-helpers_jrresult-JrResult.html">JrResult</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#._unusedCodeExpressMiddlewareInjectSessionResult">_unusedCodeExpressMiddlewareInjectSessionResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.getMergeSessionResultAndClear">getMergeSessionResultAndClear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isBlank">isBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.isJrResult">isJrResult</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeAndRemoveFromSession">makeAndRemoveFromSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeClone">makeClone</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeError">makeError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeMessage">makeMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeNew">makeNew</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.makeSuccess">makeSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.passportOrJrResultErrorAsString">passportOrJrResultErrorAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#.undefinedIfBlank">undefinedIfBlank</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#addToSession">addToSession</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clear">clear</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#clearSection">clearSection</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#copyFrom">copyFrom</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getDoneRendering">getDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getErrorsAsString">getErrorsAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getExtraData">getExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getFieldError">getFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getSuccessAsString">getSuccessAsString</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#getType">getType</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#isError">isError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#mergeIn">mergeIn</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#push">push</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushBiFieldError">pushBiFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushError">pushError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushErrorOnTop">pushErrorOnTop</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushFieldError">pushFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushMessage">pushMessage</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#pushSuccess">pushSuccess</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setDoneRendering">setDoneRendering</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setError">setError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setExtraData">setExtraData</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setFieldError">setFieldError</a></li><li data-type='method'><a href="module-helpers_jrresult-JrResult.html#setType">setType</a></li></ul></li><li><a href="module-models_app-AppModel.html">AppModel</a></li><li><a href="module-models_connection-ConnectionModel.html">ConnectionModel</a></li><li><a href="module-models_file-FileModel.html">FileModel</a></li><li><a href="module-models_login-LoginModel.html">LoginModel</a></li><li><a href="module-models_log-LogModel.html">LogModel</a></li><li><a href="module-models_model_base_mongoose_minimal-ModelBaseMongooseMinimal.html">ModelBaseMongooseMinimal</a></li><li><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html">ModelBaseMongoose</a><ul class='methods'><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#.doChangeModeById">doChangeModeById</a></li><li data-type='method'><a href="module-models_modelBaseMongoose-ModelBaseMongoose.html#doChangeMode">doChangeMode</a></li></ul></li><li><a href="module-models_modqueue-ModQueueModel.html">ModQueueModel</a></li><li><a href="module-models_option-OptionModel.html">OptionModel</a></li><li><a href="module-models_roomdata-RoomdataModel.html">RoomdataModel</a></li><li><a href="module-models_room-RoomModel.html">RoomModel</a></li><li><a href="module-models_session-SessionModel.html">SessionModel</a></li><li><a href="module-models_subscription-SubscriptionModel.html">SubscriptionModel</a></li><li><a href="module-models_user-UserModel.html">UserModel</a><ul class='methods'><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermission">aclHasPermission</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionOnAll">aclHasPermissionOnAll</a></li><li data-type='method'><a href="module-models_user-UserModel.html#aclHasPermissionSeeVDeletes">aclHasPermissionSeeVDeletes</a></li></ul></li><li><a href="module-models_verification-VerificationModel.html">VerificationModel</a></li></ul><h3>Modules</h3><ul><li><a href="module-approomglobals.html">approomglobals</a><ul class='methods'><li data-type='method'><a href="module-approomglobals.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-approomTest.html">approomTest</a></li><li><a href="module-controllers_aclaid.html">controllers/aclaid</a></li><li><a href="module-controllers_adminaid.html">controllers/adminaid</a></li><li><a href="module-controllers_appconst.html">controllers/appconst</a></li><li><a href="module-controllers_arserver.html">controllers/arserver</a></li><li><a href="module-controllers_crudaid.html">controllers/crudaid</a></li><li><a href="module-controllers_jrequireaid.html">controllers/jrequireaid</a><ul class='methods'><li data-type='method'><a href="module-controllers_jrequireaid.html#~setDeferredLoading">setDeferredLoading</a></li><li data-type='method'><a href="module-controllers_jrequireaid.html#~setupDefaultModulePaths">setupDefaultModulePaths</a></li></ul></li><li><a href="module-controllers_ratelimiteraid.html">controllers/ratelimiteraid</a></li><li><a href="module-controllers_registrationaid.html">controllers/registrationaid</a></li><li><a href="module-controllers_sendaid.html">controllers/sendaid</a></li><li><a href="module-helpers_jrconfig.html">helpers/jrconfig</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrconfig.html#~addConfigFile">addConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~doNconfFile">doNconfFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~findQueuedCommand">findQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~fixConfigFilePathName">fixConfigFilePathName</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugFiles">getDebugFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugHierarchy">getDebugHierarchy</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getDebugOptions">getDebugOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getVal">getVal</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~getValDefault">getValDefault</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~ipStringToSafeFilenameString">ipStringToSafeFilenameString</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeCliConfigFiles">nconfMergeCliConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~nconfMergeConfigFile">nconfMergeConfigFile</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~parse">parse</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~popQueuedCommand">popQueuedCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~queueYargsCommand">queueYargsCommand</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~runQueuedCommands">runQueuedCommands</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setConfigDirAndDiscoverConfigFiles">setConfigDirAndDiscoverConfigFiles</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setDefaultOptions">setDefaultOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setEnvList">setEnvList</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setOverrideOptions">setOverrideOptions</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setServerFilenamePrefixFromServerIp">setServerFilenamePrefixFromServerIp</a></li><li data-type='method'><a href="module-helpers_jrconfig.html#~setYargs">setYargs</a></li></ul></li><li><a href="module-helpers_jrdebug.html">helpers/jrdebug</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebug">cdebug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugf">cdebugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~cdebugObj">cdebugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debug">debug</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugf">debugf</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~debugObj">debugObj</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~getDebugEnabled">getDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setDebugEnabled">setDebugEnabled</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrdebug.html#~setupDebugmod">setupDebugmod</a></li></ul></li><li><a href="module-helpers_jrequire.html">helpers/jrequire</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrequire.html#~calcDebugInfo">calcDebugInfo</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~fixRequirePath">fixRequirePath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~jrequire">jrequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~plugin">plugin</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerPath">registerPath</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~registerRequire">registerRequire</a></li><li data-type='method'><a href="module-helpers_jrequire.html#~setDeferredLoading">setDeferredLoading</a></li></ul></li><li><a href="module-helpers_jrh_crypto.html">helpers/jrh_crypto</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_crypto.html#~createHashedObjectFromString">createHashedObjectFromString</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~generateRandomSalt">generateRandomSalt</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHex">genRandomStringHex</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasier">genRandomStringHumanEasier</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~genRandomStringHumanEasy">genRandomStringHumanEasy</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextPasswordToObj">hashPlaintextPasswordToObj</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~hashPlaintextStringInsecureButSearchable">hashPlaintextStringInsecureButSearchable</a></li><li data-type='method'><a href="module-helpers_jrh_crypto.html#~testPlaintextPassword">testPlaintextPassword</a></li></ul></li><li><a href="module-helpers_jrh_express.html">helpers/jrh_express</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordAuthenticate">asyncPasswordAuthenticate</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~asyncPasswordReqLogin">asyncPasswordReqLogin</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddleWare">calcExpressMiddleWare</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareGetFileLine">calcExpressMiddlewareGetFileLine</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressMiddlewareRouterHint">calcExpressMiddlewareRouterHint</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathData">calcExpressRoutePathData</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataRouteArray">calcExpressRoutePathDataRouteArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~calcExpressRoutePathDataSplit">calcExpressRoutePathDataSplit</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~forgetSessionVar">forgetSessionVar</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~normalizePort">normalizePort</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqOriginalUrl">reqOriginalUrl</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedCheckboxItemIds">reqPrefixedCheckboxItemIds</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqPrefixedValueArray">reqPrefixedValueArray</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqUrlWithPath">reqUrlWithPath</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqVal">reqVal</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValAsInt">reqValAsInt</a></li><li data-type='method'><a href="module-helpers_jrh_express.html#~reqValFromList">reqValFromList</a></li></ul></li><li><a href="module-helpers_jrh_grid.html">helpers/jrh_grid</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_grid.html#~calcHeaderKeysNicely">calcHeaderKeysNicely</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridList">jrGridList</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListBulkActions">jrGridListBulkActions</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPager">jrGridListPager</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItem">jrGridListPagerItem</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListPagerItemPerPage">jrGridListPagerItemPerPage</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTable">jrGridListTable</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableData">jrGridListTableData</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeader">jrGridListTableHeader</a></li><li data-type='method'><a href="module-helpers_jrh_grid.html#~jrGridListTableHeaderSortDir">jrGridListTableHeaderSortDir</a></li></ul></li><li><a href="module-helpers_jrh_handlebars.html">helpers/jrh_handlebars</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~loadPartialFiles">loadPartialFiles</a></li><li data-type='method'><a href="module-helpers_jrh_handlebars.html#~setupJrHandlebarHelpers">setupJrHandlebarHelpers</a></li></ul></li><li><a href="module-helpers_jrh_misc.html">helpers/jrh_misc</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncAwaitForEachFunctionCall">asyncAwaitForEachFunctionCall</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~asyncNextTick">asyncNextTick</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~createObjectFromJsonParse">createObjectFromJsonParse</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~DateNowPlusMinutes">DateNowPlusMinutes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~deepIterationCopy">deepIterationCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~findLongestPrefixAndRemainder">findLongestPrefixAndRemainder</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~firstCoercedTrueValue">firstCoercedTrueValue</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getCompactNowString">getCompactNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDateValString">getNiceDateValString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceDurationTimeMs">getNiceDurationTimeMs</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNiceNowString">getNiceNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonFalseValueOrDefault">getNonFalseValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getNonNullValueOrDefault">getNonNullValueOrDefault</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getPreciseNowString">getPreciseNowString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~getServerIpAddress">getServerIpAddress</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isInAnyArray">isInAnyArray</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectEmpty">isObjectEmpty</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isObjectHashMappableType">isObjectHashMappableType</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isPromise">isPromise</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~isSimpleObject">isSimpleObject</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~makeSafeForFormInput">makeSafeForFormInput</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysDedupe">mergeArraysDedupe</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~mergeArraysKeepDupes">mergeArraysKeepDupes</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~objToString">objToString</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~regexEscapeStr">regexEscapeStr</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~shallowCopy">shallowCopy</a></li><li data-type='method'><a href="module-helpers_jrh_misc.html#~stringArrayToNiceString">stringArrayToNiceString</a></li></ul></li><li><a href="module-helpers_jrh_mongo.html">helpers/jrh_mongo</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseResourceUse">calcDatabaseResourceUse</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~calcDatabaseStructure">calcDatabaseStructure</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~convertArrayOfObjectIdsToIdArray">convertArrayOfObjectIdsToIdArray</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~isValidMongooseObjectId">isValidMongooseObjectId</a></li><li data-type='method'><a href="module-helpers_jrh_mongo.html#~mongoIdEqual">mongoIdEqual</a></li></ul></li><li><a href="module-helpers_jrh_mongo_filter.html">helpers/jrh_mongo_filter</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~buildMongooseQueryFromReq">buildMongooseQueryFromReq</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilter">convertReqQueryStringToAMongooseFindFilter</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterBoolean">convertReqQueryStringToAMongooseFindFilterBoolean</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperator">convertReqQueryStringToAMongooseFindFilterGenericOperator</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal">convertReqQueryStringToAMongooseFindFilterGenericOperatorResolveVal</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterMongoStrCmp">convertReqQueryStringToAMongooseFindFilterMongoStrCmp</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterNumeric">convertReqQueryStringToAMongooseFindFilterNumeric</a></li><li data-type='method'><a href="module-helpers_jrh_mongo_filter.html#~convertReqQueryStringToAMongooseFindFilterStringic">convertReqQueryStringToAMongooseFindFilterStringic</a></li></ul></li><li><a href="module-helpers_jrh_text.html">helpers/jrh_text</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_text.html#~capitalizeFirstLetter">capitalizeFirstLetter</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~formatChoiceValueForGridDisplay">formatChoiceValueForGridDisplay</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrBootstrapCollapseBox">jrBootstrapCollapseBox</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormInputPassword">jrHtmlFormInputPassword</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionList">jrHtmlFormOptionList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlFormOptionListSelect">jrHtmlFormOptionListSelect</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlNiceOptionFromList">jrHtmlNiceOptionFromList</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrHtmlStrigifyObject">jrHtmlStrigifyObject</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralize">jrPluralize</a></li><li data-type='method'><a href="module-helpers_jrh_text.html#~jrPluralizeCount">jrPluralizeCount</a></li></ul></li><li><a href="module-helpers_jrh_validate.html">helpers/jrh_validate</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateInteger">validateInteger</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateIntegerRange">validateIntegerRange</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateRealName">validateRealName</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateString">validateString</a></li><li data-type='method'><a href="module-helpers_jrh_validate.html#~validateTrueFalse">validateTrueFalse</a></li></ul></li><li><a href="module-helpers_jrlog.html">helpers/jrlog</a><ul class='methods'><li data-type='method'><a href="module-helpers_jrlog.html#~aliasWinstonLogger">aliasWinstonLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~calcLogFilePath">calcLogFilePath</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createLogFileObj">createLogFileObj</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~createWinstonLoggerObject">createWinstonLoggerObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~getWinstonCategoryLogger">getWinstonCategoryLogger</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~log">log</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logDefaultError">logDefaultError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionError">logExceptionError</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logExceptionErrorWithMessage">logExceptionErrorWithMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logMessage">logMessage</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~logObject">logObject</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setup">setup</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupMorganMiddlewareForExpressWebAccessLogging">setupMorganMiddlewareForExpressWebAccessLogging</a></li><li data-type='method'><a href="module-helpers_jrlog.html#~setupWinstonLogger">setupWinstonLogger</a></li></ul></li><li><a href="module-helpers_jrresult.html">helpers/jrresult</a></li><li><a href="module-models_app.html">models/app</a></li><li><a href="module-models_connection.html">models/connection</a></li><li><a href="module-models_file.html">models/file</a></li><li><a href="module-models_log.html">models/log</a></li><li><a href="module-models_login.html">models/login</a></li><li><a href="module-models_model_base_mongoose_minimal.html">models/model_base_mongoose_minimal</a></li><li><a href="module-models_modelBaseMongoose.html">models/modelBaseMongoose</a></li><li><a href="module-models_modqueue.html">models/modqueue</a></li><li><a href="module-models_option.html">models/option</a></li><li><a href="module-models_room.html">models/room</a></li><li><a href="module-models_roomdata.html">models/roomdata</a></li><li><a href="module-models_session.html">models/session</a></li><li><a href="module-models_subscription.html">models/subscription</a></li><li><a href="module-models_user.html">models/user</a></li><li><a href="module-models_verification.html">models/verification</a></li><li><a href="module-plugins_testplugin.html">plugins/testplugin</a></li><li><a href="module-routes_admin.html">routes/admin</a></li><li></li><li></li><li><a href="module-routes_analytics.html">routes/analytics</a></li><li><a href="module-routes_api.html">routes/api</a><ul class='methods'><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenAccess">makeSecureTokenAccess</a></li><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenAccessFromRefreshToken">makeSecureTokenAccessFromRefreshToken</a></li><li data-type='method'><a href="module-routes_api.html#~makeSecureTokenRefresh">makeSecureTokenRefresh</a></li><li data-type='method'><a href="module-routes_api.html#~routerAllTokentest">routerAllTokentest</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetIndex">routerGetIndex</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetRefreshaccess">routerGetRefreshaccess</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetReqrefresh">routerGetReqrefresh</a></li><li data-type='method'><a href="module-routes_api.html#~routerGetWildcard">routerGetWildcard</a></li><li data-type='method'><a href="module-routes_api.html#~routerPostReqrefresh">routerPostReqrefresh</a></li><li data-type='method'><a href="module-routes_api.html#~setupRouter">setupRouter</a></li></ul></li><li><a href="module-routes_app.html">routes/app</a></li><li></li><li><a href="module-routes_index.html">routes/index</a></li><li><a href="module-routes_login.html">routes/login</a></li><li><a href="module-routes_logout.html">routes/logout</a></li><li><a href="module-routes_membersonly.html">routes/membersonly</a></li><li><a href="module-routes_profile.html">routes/profile</a></li><li><a href="module-routes_register.html">routes/register</a></li><li><a href="module-routes_room.html">routes/room</a></li><li><a href="module-routes_verify.html">routes/verify</a></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">helpers/jrconfig.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/**
 * @module helpers/jrconfig
 * @author jesse reichler &lt;mouser@donationcoder.com>
 * @copyright 5/9/19

 * @description
 * Configuration support module that manages configuration commandlineargs/files/options/environment
 * ##### Notes
 *  * We use nconf module for holding all configuration data;  our functions just offer ways to use that more flexibly
 *  * We use yargs to handle commandline processing; our functions just offer ways to use that more flexibly
*/

"use strict";



// modules

// nconf
const nconf = require("nconf");

// support yaml config files
const yaml = require("js-yaml");

const path = require("path");
const fs = require("fs");

// for stupid nconf display dump.. ugh we need to get rid of nconf
const mergeDeep = require("merge-deep");


// our helpers
const jrhMisc = require("./jrh_misc");
const jrlog = require("./jrlog");







//---------------------------------------------------------------------------
// constants

// what environmental variables to grab out of OS environment and put into config data
const envListDefault = ["NODE_ENV"];

// default files we always look for -- note that earlier dominates later in this list
const configFilesDefault = ["%SERVERPREFIX%_private", "%SERVERPREFIX%_public", "sitePrivate", "sitePublic", "defaultPrivate", "default"];
//---------------------------------------------------------------------------


//---------------------------------------------------------------------------
// module variables
var configDirPath;
var serverFilenamePrefix;
var envList;
var yargsObj;
var configFileCount = 0;
var didParse = false;
//
var defaultOptions = {};
var overrideOptions = {};
var queuedCommands = [];
var configFiles = [];
//---------------------------------------------------------------------------







//---------------------------------------------------------------------------
/**
 * One time call to process options that have been set through other functions first
 *
 * @throws error if you try to run this twice
 */
function parse() {
	// process env, argv, files, etc.
	if (didParse) {
		throw new Error("Parse of config files already ran and can only run once.");
	}
	// set flag saying we have parsed
	didParse = true;

	// now merge in options -- EARLIER dominates LATER (except for defaults)

	// 1. overrides, always dominate
	nconf.overrides(overrideOptions);

	// 2. commandline (via yargs?) [dominates all others]
	if (yargsObj !== undefined) {
		// ATTN: i think yargsObj has a bunch of stuff we don't really want.. maybe there's a better way to get a more compact version
		nconf.argv(yargsObj);
	} else {
		nconf.argv();
	}

	// 3. environmental variables
	nconf.env(envList);

	// 4. now we would like to load in any config files found ON THE COMMANDLINE
	// ATTN: one difficulty is we would ideally like to have the order of the files
	//  specified on commandline matter wrt other options
	//  as a practical close-enough, we might just take the list of config files,
	//  and then load them into a separate hierarchy,
	//  and always treat them as less priortity than cli args
	nconfMergeCliConfigFiles();

	// 5. now merge in any explicit list of config files
	configFiles.forEach((fileObj) => {
		if (fileObj.found) {
			nconfMergeConfigFile(fileObj.path, false);
		}
	});

	// 6*. DEFAULT config file, if it exists.
	// ATTN: we no longer call this here, since user can easily call addConfigFile("default",false)
	// nconfMergeConfigFile("default", false);

	// 7. defaultOptions object passed into us
	nconf.defaults(defaultOptions);
}
//---------------------------------------------------------------------------




//---------------------------------------------------------------------------
/**
 * Queue a command with arguments, for the yargs commandline processing library
 *
 * @param {string} commandName
 * @param {*} argv
 * @param {function} callback
 */
function queueYargsCommand(commandName, argv, callback) {
	// internally called during yargs processing when it finds a command to run

	// store the queued command
	queuedCommands.push({
		command: commandName,
		argv,
		callback,
	});
}


/**
 * Run a set of queued yarg commandline options/commands.
 *
 * @param {boolean} flagErrorIfNone
 */
function runQueuedCommands(flagErrorIfNone) {
	// run all queued commands

	// error if none, and show help
	if (flagErrorIfNone &amp;&amp; queuedCommands.length === 0) {
		if (yargsObj !== undefined) {
			yargsObj.showHelp();
		} else {
			jrlog.logDefaultError("Error: No command specified to run on commandline.");
		}
		return;
	}

	// run them
	queuedCommands.forEach((cmdEntry) => {
		if (cmdEntry.callback) {
			cmdEntry.callback(cmdEntry.command, cmdEntry.argv);
		} else {
			jrlog.logDefaultError("Warning: No callback to run for command " + cmdEntry.cmd);
		}
	});
}


/**
 * An alternate way to manually go through queue of commands
 * @returns the next queued command, in format \{command: commandName, argv, callback\}
 */
function popQueuedCommand() {
	if (queuedCommands.length === 0) {
		return undefined;
	}
	var retv = queuedCommands[0];
	queuedCommands.splice(0, 1);
	return retv;
}


/**
 * Find a queud command by name and return it.
 * This is useful as an alternative way of finding commands explicitly
 *
 * @param {string} cmd
 * @param {boolean} flagPop - if true the found command will be popped off the queue
 * @returns undefined if not found, or queued command in format \{command: commandName, argv, callback\}
 */
function findQueuedCommand(cmd, flagPop) {
	// find the command cmd in the queued list and return it
	var len = queuedCommands.length;
	for (var i = 0; i &lt; len; i++) {
		if (queuedCommands[i].command === cmd) {
			// found it
			var retv = queuedCommands[i];
			if (flagPop) {
				queuedCommands.splice(i, 1);
			}
			return retv;
		}
	}
	return undefined;
}
//---------------------------------------------------------------------------








//---------------------------------------------------------------------------
/**
 * Set the base directory for config files and find a list of all valid config files in this subdir
 * ##### Notes
 *  * Normally you would call this with the actual directory containing the config files, but if you call it with the parent directory, it will look for a "config/" subdir and use that instead.
 *  * This function then looks for a set of specific filenames in the config directory, in a specificy priority order, and queues the ones it finds
 *
 * @param {string} val - base directory where config files are stored
 */
function setConfigDirAndDiscoverConfigFiles(val) {
	// configDirPath can be base path where there is a config subdir, or the full path to the configdir;
	//  filenames specified via config option will be looked for in this dir
	// fixups - auto add config subdir if caller passed in base dir
	var configDirPathPlus = path.join(val, "config");
	if (fs.existsSync(configDirPathPlus)) {
		configDirPath = configDirPathPlus;
	} else {
		configDirPath = val;
	}

	// now that we have the config fir, we can se the default a default configfile to process before others
	configFilesDefault.forEach((filepath) => {
		addConfigFile(filepath, false);
	});
}


/**
 * Set an object with default config options, which will be overridden by options found in config files
 *
 * @param {object} - configuration object with properties that will be used if no config file sets them
 */
function setDefaultOptions(val) {
	// defaultOptions is an object loaded into values which are overridden by others from commandline, files, env, etc.
	defaultOptions = val;

}


/**
 * Set an object containing override options that will take precedence over any options found in any config files
 *
 * @param {object} val - configuration object with properties that will override any config file
 */
function setOverrideOptions(val) {
	// overrideOptions is a setting oject whose contents will override anything else read in any other stting
	overrideOptions = val;
}

/**
 * Sets the list of environment variable key names that will be loaded into the config environment (if not overridden in config files)
 *
 * @param {array} val - list of strings that identify which variables from environment to load
 */
function setEnvList(val) {
	envList = jrhMisc.mergeArraysDedupe(val, envListDefault);
}

/**
 * The caller should pass us the yargs commandline processor module object to use
 *
 * @param {object} val
 */
function setYargs(val) {
	// called after creation, so that yargsObj can point to us
	yargsObj = val;
}
//---------------------------------------------------------------------------














//---------------------------------------------------------------------------
// private functions
/**
 * Helper function to add a file to our queued list of config files (which will be processed in order)
 * @private
 *
 * @param {*} filepath
 * @param {*} flagErrorOnFileNotExist - if set then an exception will be thrown if file does not exist; otherwise nothing happens
 * @returns true if file found and loaded
 * @throws error if file is not found and flagErrorOnFileNotExist is true
 */
function addConfigFile(filepath, flagErrorOnFileNotExist) {
	// queue a config file to load
	var filepathFixed = fixConfigFilePathName(filepath);
	if (!fs.existsSync(filepathFixed)) {
		if (flagErrorOnFileNotExist) {
			// it"s an error that we couldn"t find it
			throw (new Error("Could not locate config file: " + filepath));
		}
		// not found so don"t add it
		configFiles.push({
			path: filepathFixed,
			found: false,
		});
		return false;
	}
	configFiles.push({
		path: filepathFixed,
		found: true,
	});
	return true;
}




/**
 * Get a list of config files specified on the commandline via nconf, and load those in
 * @private
 */
function nconfMergeCliConfigFiles() {
	// find any config files requested on the commandline
	var configFileStr = nconf.get("config");
	if (!configFileStr) {
		// nothing to do
		return;
	}
	// split list of config files by commas
	var configFileStrs = configFileStr.split(",");
	configFileStrs.forEach((configFilePath) => {
		// try to load it
		nconfMergeConfigFile(configFilePath, true);
	});
}


/**
 * Merge in a config file to nconf configuration settings using nconf.file command
 * @private
 *
 * @param {string} filepath
 * @param {boolean} flagErrorOnFileNotExist - throw an error if file does not exist?
 * @returns true if file found and loaded
 * @throws exception if file is missing and flagErrorOnFileNotExist is true
 */
function nconfMergeConfigFile(filepath, flagErrorOnFileNotExist) {
	// merge in a file of options
	filepath = fixConfigFilePathName(filepath);
	if (!fs.existsSync(filepath)) {
		if (flagErrorOnFileNotExist) {
			throw (new Error("Config file does not exist: " + filepath));
		}
		return false;
	}
	// keep track of # of files loaded, each must have their own unique key because nconf is weird
	// note that these options are still available merged when we call get() but when loaded they must have unique rootTag
	// I gather this is so we can CHANGE all under a key by reloading
	configFileCount += 1;
	var rootTag = "jrConfigFile_" + (configFileCount).toString();
	// merge in file options, under rootTag
	doNconfFile(rootTag, filepath);
	return true;
}


/**
 * Invoke the nconf.file function but check file extension and support yaml files
 * @private
 *
 * @param {*} rootTag tag for nconf
 * @param {*} filepath filepath for nconf
 */
function doNconfFile(rootTag, filepath) {
	var retv;

	if (filepath.indexOf(".yaml") !== -1 || filepath.indexOf(".yml") !== -1) {
		// ok its a yaml file
		// see https://gist.github.com/clarkdave/f31d92ca88d11ef5340c
		// console.log("ATTN: doNconfFile yaml file: " + filepath);
		retv = nconf.file(rootTag, {
			file: filepath,
			format: {
				parse: yaml.safeLoad,
				stringify: yaml.safeDump,
			},
		});
	} else {
		// fall back on json/native nconf file we assume
		// console.log("ATTN: doNconfFile JSON file: " + filepath);
		retv = nconf.file(rootTag, filepath);
	}
	return retv;
}


/**
 * Fixup config file name by adding base directory, doing any %SPECIAL% substrings and adding .json after it if its not explicitly provided
 * @private
 * @todo support jsoc files?
 *
 * @param {string} filepath
 * @returns filepath with base directory and extension (yml) added
 */
function fixConfigFilePathName(filepath) {
	// fixup filepath specified to add extension and relative to our base path

	// fixup special fields
	filepath = filepath.replace("%SERVERPREFIX%", serverFilenamePrefix);

	// add assumed extension
	if (filepath.indexOf(".yaml") === -1 &amp;&amp; filepath.indexOf(".yml") === -1 &amp;&amp; filepath.indexOf(".json") === -1) {
		// ATTN: new default is yml (yaml)
		filepath += ".yml";
	}
	// add path
	if (!fs.existsSync(filepath)) {
		filepath = path.join(configDirPath, filepath);
	}
	return filepath;
}
//---------------------------------------------------------------------------







//---------------------------------------------------------------------------
// accessors

/**
 * Just pass along a get request to the underlying nconf module.
 * Use getValDefault if you don't want exception error thrown on missing variable
 * @private
 * @example getVal("DEBUG") - returns the value of the DEBUG config variable
 *
 * @param {*} variadic args but normally just a single string with the variable name
 * @returns value
 * @throws error if variable not found
 */
function getVal(...args) {
	// just pass along to nconf
	var val = nconf.get(...args);
	if (val === undefined) {
		throw new Error("Request for config getVal of a non-existent variable (" + args[0] + ")");
	}
	return val;
}


/**
 * Get the value of a variable; if its undefined then return defaultVal
 * @private
 *
 * @param {string} arg - variable name to find
 * @param {*} defaultVal
 * @returns the config value for variable specified, or defaultVal if not found
 */
function getValDefault(arg, defaultVal) {
	var val = nconf.get(arg);
	if (val === undefined) {
		return defaultVal;
	}
	return val;
}


/**
 * Caller should call this in order for us to discover and load SERVERIP prefixed config files automatically
 * @private
 *
 * @param {string} val - server ip as string (we will convert : to _)
 */
function setServerFilenamePrefixFromServerIp(val) {
	val = ipStringToSafeFilenameString(val);
	serverFilenamePrefix = val;
}


/**
 * Replace filename illegal characters (:) from ip string with underscores
 *
 * @param {*} val - ip string with colons
 * @returns ip string with colons replaced with underscores
 */
function ipStringToSafeFilenameString(val) {
	// replace . and : with _
	val = val.replace(/[.:]+/g, "_");
	return val;
}
//---------------------------------------------------------------------------






//---------------------------------------------------------------------------
/**
 * Function for diagnostics/debugging.
 *
 * @returns an object that contains the merged set of options, so that overridden options are respected
 */
function getDebugOptions() {
	// for debug introspection

	// iterate nconf stores and merge them -- THIS is how we get a compact list of the nconf values actually available -- a dump of nconf values
	// it is necesary to be so ridiculous because nconf does not store a merged set of keyvalues as you might expect if you were sane, but instead
	// it keeps all values and does a full lookup each time you query.
	// This is why we need to get rid of nconf asap
	var nconfDataMerged = {};
	var astore;
	var storekeys = Object.keys(nconf.stores);
	storekeys.reverse();
	storekeys.forEach((key) => {
		astore = nconf.stores[key].store;
		nconfDataMerged = mergeDeep(nconfDataMerged, astore);
	});

	var debugObj = {
		options: nconfDataMerged,
	};
	return debugObj;
}



/**
 * Function for diagnostics/debugging.
 *
 * @returns an object that contains a list of the config files in order of priority
 */
function getDebugFiles() {
	// for debug introspection

	var debugObj = {
		configFiles,
	};
	return debugObj;
}





/**
 * Function for diagnostics/debugging.
 *
 * @returns an object that contains a list of the config files in order of priority
 */
function getDebugHierarchy() {
	// for debug introspection

	var debugObj = {
		nconf_stores: nconf.stores,
	};
	return debugObj;
}
//---------------------------------------------------------------------------











module.exports = {
	parse,
	queueYargsCommand,
	runQueuedCommands,
	findQueuedCommand,

	setConfigDirAndDiscoverConfigFiles,
	setDefaultOptions,
	setOverrideOptions,
	setEnvList,
	setYargs,

	getVal,
	getValDefault,
	setServerFilenamePrefixFromServerIp,

	getDebugOptions,
	getDebugFiles,
	getDebugHierarchy,
};

</code></pre>
        </article>
    </section>




    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Tue Apr 14 2020 16:25:44 GMT-0500 (Central Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>
